<html>
<head>
<title>MayaChemTools:Code:PyMOLVisualizeCryoEMDensity.py</title>
<meta http-equiv="content-type" content="text/html;charset=utf-8">
<link rel="stylesheet" type="text/css" href="../../../css/MayaChemToolsPythonCode.css">
</head>
<body leftmargin="20" rightmargin="20" topmargin="10" bottommargin="10">
<br/>
<center>
<a href="http://www.mayachemtools.org" title="MayaChemTools Home"><img src="../../../images/MayaChemToolsLogo.gif" border="0" alt="MayaChemTools"></a>
</center>
<br/>
<pre>
    1 <span class="ch">#!/bin/env python</span>
    2 <span class="c1">#</span>
    3 <span class="c1"># File: PyMOLVisualizeCryoEMDensity.py</span>
    4 <span class="c1"># Author: Manish Sud &lt;msud@san.rr.com&gt;</span>
    5 <span class="c1">#</span>
    6 <span class="c1"># Copyright (C) 2018 Manish Sud. All rights reserved.</span>
    7 <span class="c1">#</span>
    8 <span class="c1"># The functionality available in this script is implemented using PyMOL, a</span>
    9 <span class="c1"># molecular visualization system on an open source foundation originally</span>
   10 <span class="c1"># developed by Warren DeLano.</span>
   11 <span class="c1">#</span>
   12 <span class="c1"># This file is part of MayaChemTools.</span>
   13 <span class="c1">#</span>
   14 <span class="c1"># MayaChemTools is free software; you can redistribute it and/or modify it under</span>
   15 <span class="c1"># the terms of the GNU Lesser General Public License as published by the Free</span>
   16 <span class="c1"># Software Foundation; either version 3 of the License, or (at your option) any</span>
   17 <span class="c1"># later version.</span>
   18 <span class="c1">#</span>
   19 <span class="c1"># MayaChemTools is distributed in the hope that it will be useful, but without</span>
   20 <span class="c1"># any warranty; without even the implied warranty of merchantability of fitness</span>
   21 <span class="c1"># for a particular purpose.  See the GNU Lesser General Public License for more</span>
   22 <span class="c1"># details.</span>
   23 <span class="c1">#</span>
   24 <span class="c1"># You should have received a copy of the GNU Lesser General Public License</span>
   25 <span class="c1"># along with MayaChemTools; if not, see &lt;http://www.gnu.org/licenses/&gt; or</span>
   26 <span class="c1"># write to the Free Software Foundation Inc., 59 Temple Place, Suite 330,</span>
   27 <span class="c1"># Boston, MA, 02111-1307, USA.</span>
   28 <span class="c1">#</span>
   29 
   30 <span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">print_function</span>
   31 
   32 <span class="c1"># Add local python path to the global path and import standard library modules...</span>
   33 <span class="kn">import</span> <span class="nn">os</span>
   34 <span class="kn">import</span> <span class="nn">sys</span><span class="p">;</span>  <span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="s2">&quot;..&quot;</span><span class="p">,</span> <span class="s2">&quot;lib&quot;</span><span class="p">,</span> <span class="s2">&quot;Python&quot;</span><span class="p">))</span>
   35 <span class="kn">import</span> <span class="nn">time</span>
   36 <span class="kn">import</span> <span class="nn">re</span>
   37 <span class="kn">import</span> <span class="nn">xml.etree.ElementTree</span> <span class="kn">as</span> <span class="nn">ElementTree</span>
   38 
   39 <span class="c1"># PyMOL imports...</span>
   40 <span class="k">try</span><span class="p">:</span>
   41     <span class="kn">import</span> <span class="nn">pymol</span>
   42     <span class="c1"># Finish launching PyMOL in  a command line mode for batch processing (-c)</span>
   43     <span class="c1"># along with the following options:  disable loading of pymolrc and plugins (-k);</span>
   44     <span class="c1"># suppress start up messages (-q)</span>
   45     <span class="n">pymol</span><span class="o">.</span><span class="n">finish_launching</span><span class="p">([</span><span class="s1">&#39;pymol&#39;</span><span class="p">,</span> <span class="s1">&#39;-ckq&#39;</span><span class="p">])</span>
   46 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   47     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import PyMOL module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   48     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your PyMOL environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   49     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   50 
   51 <span class="c1"># MayaChemTools imports...</span>
   52 <span class="k">try</span><span class="p">:</span>
   53     <span class="kn">from</span> <span class="nn">docopt</span> <span class="kn">import</span> <span class="n">docopt</span>
   54     <span class="kn">import</span> <span class="nn">MiscUtil</span>
   55     <span class="kn">import</span> <span class="nn">PyMOLUtil</span>
   56 <span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">ErrMsg</span><span class="p">:</span>
   57     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Failed to import MayaChemTools module/package: </span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ErrMsg</span><span class="p">)</span>
   58     <span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;Check/update your MayaChemTools environment and try again.</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
   59     <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
   60 
   61 <span class="n">ScriptName</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
   62 <span class="n">Options</span> <span class="o">=</span> <span class="p">{}</span>
   63 <span class="n">OptionsInfo</span> <span class="o">=</span> <span class="p">{}</span>
   64 
   65 <span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
   66     <span class="sd">&quot;&quot;&quot;Start execution of the script&quot;&quot;&quot;</span>
   67     
   68     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2"> (PyMOL v</span><span class="si">%s</span><span class="s2">; </span><span class="si">%s</span><span class="s2">) Starting...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ScriptName</span><span class="p">,</span> <span class="n">pymol</span><span class="o">.</span><span class="n">cmd</span><span class="o">.</span><span class="n">get_version</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span> <span class="n">time</span><span class="o">.</span><span class="n">asctime</span><span class="p">()))</span>
   69     
   70     <span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">)</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetWallClockAndProcessorTime</span><span class="p">()</span>
   71     
   72     <span class="c1"># Retrieve command line arguments and options...</span>
   73     <span class="n">RetrieveOptions</span><span class="p">()</span>
   74     
   75     <span class="c1"># Process and validate command line arguments and options...</span>
   76     <span class="n">ProcessOptions</span><span class="p">()</span>
   77 
   78     <span class="c1"># Perform actions required by the script...</span>
   79     <span class="n">GenerateCryoEMDensityVisualization</span><span class="p">()</span>
   80     
   81     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="s2">: Done...</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">ScriptName</span><span class="p">)</span>
   82     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Total time: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetFormattedElapsedTime</span><span class="p">(</span><span class="n">WallClockTime</span><span class="p">,</span> <span class="n">ProcessorTime</span><span class="p">))</span>
   83 
   84 <span class="k">def</span> <span class="nf">GenerateCryoEMDensityVisualization</span><span class="p">():</span>
   85     <span class="sd">&quot;&quot;&quot;Generate cryo-EM density visualization.&quot;&quot;&quot;</span>
   86     
   87     <span class="n">Outfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span>
   88     <span class="n">OutFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Outfile</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
   89     <span class="k">if</span> <span class="n">OutFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
   90         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to open output fie </span><span class="si">%s</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
   91     
   92     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Outfile</span><span class="p">)</span>
   93 
   94     <span class="c1"># Setup header...</span>
   95     <span class="n">WritePMLHeader</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ScriptName</span><span class="p">)</span>
   96     <span class="n">WritePyMOLParameters</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
   97 
   98     <span class="c1"># Load reffile for alignment..</span>
   99     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
  100         <span class="n">WriteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
  101 
  102     <span class="c1"># Setup view for each input file...</span>
  103     <span class="n">FirstComplex</span> <span class="o">=</span> <span class="bp">True</span>
  104     <span class="n">FirstComplexFirstChainName</span> <span class="o">=</span> <span class="bp">None</span>
  105     <span class="k">for</span> <span class="n">FileIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])):</span>
  106         <span class="c1"># Setup PyMOL object names...</span>
  107         <span class="n">PyMOLObjectNames</span> <span class="o">=</span> <span class="n">SetupPyMOLObjectNames</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">)</span>
  108 
  109         <span class="c1"># Setup complex view...</span>
  110         <span class="n">WriteComplexView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">FirstComplex</span><span class="p">)</span>
  111         
  112         <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  113         <span class="n">FirstChain</span> <span class="o">=</span> <span class="bp">True</span>
  114         <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
  115             <span class="k">if</span> <span class="n">FirstComplex</span> <span class="ow">and</span> <span class="n">FirstChain</span><span class="p">:</span>
  116                 <span class="n">FirstComplexFirstChainName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span>
  117                 
  118             <span class="n">WriteChainView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  119             
  120             <span class="c1"># Setup ligand views...</span>
  121             <span class="n">FirstLigand</span> <span class="o">=</span> <span class="bp">True</span>
  122             <span class="k">for</span> <span class="n">LigandID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]:</span>
  123                 <span class="n">WriteChainLigandView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">)</span>
  124                 
  125                 <span class="c1"># Set up ligand level group...</span>
  126                 <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  127                 <span class="k">if</span> <span class="n">FirstLigand</span><span class="p">:</span>
  128                     <span class="n">FirstLigand</span> <span class="o">=</span> <span class="bp">False</span>
  129                     <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  130                 <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  131             
  132             <span class="c1"># Setup Chain level group...</span>
  133             <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  134             <span class="k">if</span> <span class="n">FirstChain</span><span class="p">:</span>
  135                 <span class="n">FirstChain</span> <span class="o">=</span> <span class="bp">False</span>
  136                 <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  137             <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  138     
  139         <span class="c1"># Set up complex level group...</span>
  140         <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">]</span>
  141         <span class="k">if</span> <span class="n">FirstComplex</span><span class="p">:</span>
  142             <span class="n">FirstComplex</span> <span class="o">=</span> <span class="bp">False</span>
  143             <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="p">[</span><span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;open&quot;</span><span class="p">]</span>
  144         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">],</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  145         
  146         <span class="c1"># Delete empty PyMOL objects...</span>
  147         <span class="n">DeleteEmptyPyMOLObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  148         
  149     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
  150         <span class="n">DeleteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">)</span>
  151 
  152     <span class="k">if</span> <span class="n">FirstComplexFirstChainName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  153         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">cmd.orient(&quot;</span><span class="si">%s</span><span class="s2">&quot;, animate = -1)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">FirstComplexFirstChainName</span><span class="p">)</span>
  154     <span class="k">else</span><span class="p">:</span>
  155         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">cmd.orient(&quot;visible&quot;, animate = -1)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
  156     
  157     <span class="n">OutFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  158 
  159     <span class="c1"># Generate PSE file as needed...</span>
  160     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOut&quot;</span><span class="p">]:</span>
  161         <span class="n">GeneratePyMOLSessionFile</span><span class="p">()</span>
  162 
  163 <span class="k">def</span> <span class="nf">WritePMLHeader</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ScriptName</span><span class="p">):</span>
  164     <span class="sd">&quot;&quot;&quot;Write out PML setting up complex view&quot;&quot;&quot;</span>
  165 
  166     <span class="n">HeaderInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLHeaderInfo</span><span class="p">(</span><span class="n">ScriptName</span><span class="p">)</span>
  167     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">HeaderInfo</span><span class="p">)</span>
  168 
  169 <span class="k">def</span> <span class="nf">WritePyMOLParameters</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  170     <span class="sd">&quot;&quot;&quot;Write out PyMOL global parameters. &quot;&quot;&quot;</span>
  171 
  172     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  173     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;mesh_width&quot;, </span><span class="si">%.2f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshWidth&quot;</span><span class="p">]))</span>
  174     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;transparency&quot;, </span><span class="si">%.2f</span><span class="s2">, &quot;&quot;, 0)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceTransparency&quot;</span><span class="p">]))</span>
  175     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_font_id&quot;, </span><span class="si">%s</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LabelFontID&quot;</span><span class="p">]))</span>
  176 
  177     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampCreate&quot;</span><span class="p">]:</span>
  178         <span class="n">ColorRampName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span>
  179         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampContourLevel&quot;</span><span class="p">]</span>
  180         <span class="n">LowerContourLevel</span> <span class="o">=</span> <span class="n">ContourLevel</span> <span class="o">-</span> <span class="mf">0.3</span>
  181         <span class="n">UpperContourLevel</span> <span class="o">=</span> <span class="n">ContourLevel</span> <span class="o">+</span> <span class="mf">0.3</span>
  182         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume_ramp_new(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%.2f</span><span class="s2"> blue 0.00 </span><span class="si">%.2f</span><span class="s2"> cyan 0.20 </span><span class="si">%.2f</span><span class="s2"> blue 0.00&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ColorRampName</span><span class="p">,</span> <span class="n">LowerContourLevel</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">UpperContourLevel</span><span class="p">))</span>
  183         
  184     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  185     
  186     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up PyMOL gobal parameters...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
  187     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  188     
  189 <span class="k">def</span> <span class="nf">WriteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  190     <span class="sd">&quot;&quot;&quot;Setup object for alignment reference &quot;&quot;&quot;</span>
  191 
  192     <span class="n">RefFileInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span>
  193     <span class="n">RefFile</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span>
  194     <span class="n">RefName</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span>
  195     
  196     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  197     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefFile</span><span class="p">,</span> <span class="n">RefName</span><span class="p">))</span>
  198     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.hide(&quot;everything&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefName</span><span class="p">))</span>
  199     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.disable(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefName</span><span class="p">))</span>
  200     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  201     
  202     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Loading </span><span class="si">%s</span><span class="s2"> and setting up view for align reference...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">RefFile</span><span class="p">)</span>
  203     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  204     
  205 <span class="k">def</span> <span class="nf">WriteAlignComplex</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  206     <span class="sd">&quot;&quot;&quot;Setup alignment of complex to reference&quot;&quot;&quot;</span>
  207 
  208     <span class="n">RefFileInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span>
  209     <span class="n">RefName</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span>
  210     
  211     <span class="n">ComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">]</span>
  212     
  213     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstChain$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMode&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  214         <span class="n">RefFirstChainID</span> <span class="o">=</span> <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
  215         <span class="n">RefAlignSelection</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> and chain </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">RefName</span><span class="p">,</span> <span class="n">RefFirstChainID</span><span class="p">)</span>
  216         
  217         <span class="n">ComplexFirstChainID</span> <span class="o">=</span> <span class="n">RetrieveFirstChainID</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">)</span>
  218         <span class="n">ComplexAlignSelection</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2"> and chain </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ComplexName</span><span class="p">,</span> <span class="n">ComplexFirstChainID</span><span class="p">)</span>
  219     <span class="k">else</span><span class="p">:</span>
  220         <span class="n">RefAlignSelection</span> <span class="o">=</span> <span class="n">RefName</span>
  221         <span class="n">ComplexAlignSelection</span> <span class="o">=</span> <span class="n">ComplexName</span>
  222 
  223     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForAlignment</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMethod&quot;</span><span class="p">],</span> <span class="n">RefAlignSelection</span><span class="p">,</span> <span class="n">ComplexAlignSelection</span><span class="p">)</span>
  224     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Aligning </span><span class="si">%s</span><span class="s2"> against reference </span><span class="si">%s</span><span class="s2"> ...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ComplexAlignSelection</span><span class="p">,</span> <span class="n">RefAlignSelection</span><span class="p">))</span>
  225     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  226     
  227 <span class="k">def</span> <span class="nf">DeleteAlignReference</span><span class="p">(</span><span class="n">OutFH</span><span class="p">):</span>
  228     <span class="sd">&quot;&quot;&quot;Delete alignment reference object.&quot;&quot;&quot;</span>
  229     
  230     <span class="n">RefName</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">][</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span>
  231     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Deleting alignment reference object </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">RefName</span><span class="p">)</span>
  232     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.delete(&quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">RefName</span><span class="p">)</span>
  233 
  234 <span class="k">def</span> <span class="nf">WriteComplexView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">FirstComplex</span><span class="p">):</span>
  235     <span class="sd">&quot;&quot;&quot;Write out PML for viewing polymer complex along with cryo-EM density.&quot;&quot;&quot;</span>
  236 
  237     <span class="c1"># Setup complex...</span>
  238     <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  239     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolymerComplexView</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">],</span> <span class="n">Infile</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
  240     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Loading </span><span class="si">%s</span><span class="s2"> and setting up view for complex...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
  241     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  242 
  243     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
  244         <span class="c1"># No need to align complex on to itself...</span>
  245         <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">and</span> <span class="n">FirstComplex</span><span class="p">):</span>
  246             <span class="n">WriteAlignComplex</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  247 
  248     <span class="c1"># Setup cryo-EM density maps and meshes...</span>
  249     <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  250     <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  251     <span class="n">WriteComplexCryoEMDensityMapView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">DensityMapFile</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">)</span>
  252 
  253     <span class="c1"># Setup complex group...</span>
  254     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">],</span> <span class="bp">False</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  255 
  256 <span class="k">def</span> <span class="nf">WriteComplexCryoEMDensityMapView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">MapFileName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">):</span>
  257     <span class="sd">&quot;&quot;&quot;Write out PML for viewing cryoEM density map.&quot;&quot;&quot;</span>
  258 
  259     <span class="c1"># Load cryo-EM density map and setup mesh views...</span>
  260     <span class="n">Info</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span><span class="se">\</span>
  261 <span class="s2">&quot;&quot;</span>
  262 <span class="s2">&quot;Loading cryo-EM density map </span><span class="si">%s</span><span class="s2"> and setting up mesh view for complex...&quot;</span>
  263 <span class="s2">&quot;&quot; &quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">MapFileName</span>
  264     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Info</span><span class="p">)</span>
  265 
  266     <span class="n">MapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  267     <span class="n">ComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">]</span>
  268     
  269     <span class="n">Color</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span>
  270     <span class="n">VolumeColorRamp</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span>
  271     
  272     <span class="n">VolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMVolume&quot;</span><span class="p">]</span>
  273     <span class="n">MeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMesh&quot;</span><span class="p">]</span>
  274     <span class="n">SurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMSurface&quot;</span><span class="p">]</span>
  275     
  276     <span class="n">AlignMapToObjectName</span> <span class="o">=</span> <span class="n">ComplexName</span> <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]</span> <span class="k">else</span> <span class="bp">None</span>
  277     <span class="n">EnableMap</span> <span class="o">=</span> <span class="bp">True</span>
  278     <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMap</span><span class="p">(</span><span class="n">MapFileName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">AlignMapToObjectName</span><span class="p">,</span> <span class="n">EnableMap</span><span class="p">)</span>
  279     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  280 
  281     <span class="n">EnableMesh</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]</span>
  282     
  283     <span class="n">EnableVolume</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]</span>
  284     <span class="k">if</span> <span class="n">EnableVolume</span> <span class="ow">and</span> <span class="n">EnableMesh</span><span class="p">:</span>
  285         <span class="n">EnableVolume</span> <span class="o">=</span> <span class="bp">False</span>
  286         
  287     <span class="n">EnableSurface</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]</span>
  288     <span class="k">if</span> <span class="n">EnableSurface</span> <span class="ow">and</span> <span class="p">(</span><span class="n">EnableVolume</span> <span class="ow">or</span> <span class="n">EnableMesh</span><span class="p">):</span>
  289         <span class="n">EnableSurface</span> <span class="o">=</span> <span class="bp">False</span>
  290     
  291     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]:</span>
  292         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableVolume</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ComplexName</span><span class="p">)</span>
  293         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  294     
  295     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]:</span>
  296         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableMesh</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ComplexName</span><span class="p">)</span>
  297         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  298 
  299     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]:</span>
  300         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableSurface</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ComplexName</span><span class="p">)</span>
  301         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  302 
  303     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  304     
  305 <span class="k">def</span> <span class="nf">WriteChainView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  306     <span class="sd">&quot;&quot;&quot;Write out PML for viewing chain.&quot;&quot;&quot;</span>
  307     
  308     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">ChainID</span><span class="p">)</span>
  309     
  310     <span class="n">ChainComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  311     
  312     <span class="c1"># Setup chain complex group view...</span>
  313     <span class="n">WriteChainComplexAndMeshViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  314 
  315     <span class="c1"># Setup chain view...</span>
  316     <span class="n">WriteChainAloneViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  317     
  318     <span class="c1"># Setup chain solvent view...</span>
  319     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForSolventView</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Solvent&quot;</span><span class="p">],</span> <span class="n">ChainComplexName</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  320     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  321 
  322     <span class="c1"># Setup chain inorganic view...</span>
  323     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForInorganicView</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Inorganic&quot;</span><span class="p">],</span> <span class="n">ChainComplexName</span><span class="p">,</span> <span class="bp">False</span><span class="p">)</span>
  324     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  325 
  326 <span class="k">def</span> <span class="nf">WriteChainComplexAndMeshViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  327     <span class="sd">&quot;&quot;&quot;Write chain complex and mesh views. &quot;&quot;&quot;</span>
  328     
  329     <span class="c1"># Setup chain complex...</span>
  330     <span class="n">ChainComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  331     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolymerChainComplexView</span><span class="p">(</span><span class="n">ChainComplexName</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">],</span> <span class="n">ChainID</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
  332     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  333 
  334     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  335     
  336     <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  337     <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  338     <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  339     
  340     <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableVolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  341     <span class="n">EnableMeshChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableMeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  342     <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableSurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  343     
  344     <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">or</span> <span class="n">VolumeChainComplex</span> <span class="ow">or</span> <span class="n">SurfaceChainComplex</span><span class="p">:</span>
  345         <span class="c1"># Set up cryoEM mesh and group...</span>
  346         <span class="n">MapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  347         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  348         <span class="n">Color</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span>
  349         
  350         <span class="n">VolumeColorRamp</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span>
  351         
  352         <span class="n">VolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMVolume&quot;</span><span class="p">]</span>
  353         <span class="n">MeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMMesh&quot;</span><span class="p">]</span>
  354         <span class="n">SurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMSurface&quot;</span><span class="p">]</span>
  355         
  356         <span class="k">if</span> <span class="n">VolumeChainComplex</span><span class="p">:</span>
  357             <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableVolumeChainComplex</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ChainComplexName</span><span class="p">)</span>
  358             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  359             
  360         <span class="k">if</span> <span class="n">MeshChainComplex</span><span class="p">:</span>
  361             <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableMeshChainComplex</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ChainComplexName</span><span class="p">)</span>
  362             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  363         
  364         <span class="k">if</span> <span class="n">SurfaceChainComplex</span><span class="p">:</span>
  365             <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="n">EnableSurfaceChainComplex</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">ChainComplexName</span><span class="p">)</span>
  366             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  367         
  368         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  369         
  370     <span class="c1"># Setup chain complex group...</span>
  371     <span class="n">EnableChainComplexGroup</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainComplexGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  372     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroupMembers&quot;</span><span class="p">],</span> <span class="n">EnableChainComplexGroup</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  373     
  374 <span class="k">def</span> <span class="nf">WriteChainAloneViews</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  375     <span class="sd">&quot;&quot;&quot;Write individual chain views. &quot;&quot;&quot;</span>
  376 
  377     <span class="n">ChainComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  378     
  379     <span class="c1"># Setup chain view...</span>
  380     <span class="n">ChainName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span>
  381     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolymerChainView</span><span class="p">(</span><span class="n">ChainName</span><span class="p">,</span> <span class="n">ChainComplexName</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  382     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  383 
  384     <span class="c1"># Setup chain putty by B-factor view...</span>
  385     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorChainCartoonPutty&quot;</span><span class="p">]:</span>
  386         <span class="n">BFactorPuttyName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneBFactorPutty&quot;</span><span class="p">]</span>
  387         <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForBFactorPuttyView</span><span class="p">(</span><span class="n">BFactorPuttyName</span><span class="p">,</span> <span class="n">ChainName</span><span class="p">,</span> <span class="n">ColorPalette</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorColorPalette&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
  388         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  389         
  390     <span class="c1"># Setup chain group...</span>
  391     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  392     <span class="n">EnableChainAloneGroup</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainAloneGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  393     <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroup&quot;</span><span class="p">],</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">],</span> <span class="n">EnableChainAloneGroup</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  394     
  395 <span class="k">def</span> <span class="nf">WriteChainLigandView</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">):</span>
  396     <span class="sd">&quot;&quot;&quot;Write out PML for viewing ligand in a chain.&quot;&quot;&quot;</span>
  397     
  398     <span class="k">for</span> <span class="n">GroupID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Ligand&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketSolvent&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketInorganic&quot;</span><span class="p">]:</span>
  399         <span class="n">ComplexName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  400         <span class="n">LigandName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;Ligand&quot;</span><span class="p">]</span>
  401         
  402         <span class="c1"># Setup main object...</span>
  403         <span class="n">GroupTypeObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  404         <span class="n">GroupTypeObjectName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupTypeObjectID</span><span class="p">]</span>
  405         
  406         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Ligand$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  407             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  408             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
  409             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  410         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  411             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for pocket around ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  412             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandPocketView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="bp">True</span><span class="p">)</span>
  413             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  414             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketLabelColor&quot;</span><span class="p">],</span> <span class="n">GroupTypeObjectName</span><span class="p">))</span>
  415         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketSolvent$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  416             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for solvent in pockect around ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  417             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandPocketSolventView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  418             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  419         <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketInorganic$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  420             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up views for inorganic in pockect around ligand </span><span class="si">%s</span><span class="s2"> in chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">LigandID</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">))</span>
  421             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForLigandPocketInorganicView</span><span class="p">(</span><span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ComplexName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">)</span>
  422             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  423         
  424         <span class="c1"># Set up cryoEM mesh and group...</span>
  425         <span class="n">CryoEMMeshGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroup&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  426         <span class="n">CryoEMMeshGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  427         <span class="n">CryoEMVolumeID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMVolume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  428         <span class="n">CryoEMMeshID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  429         <span class="n">CryoEMSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  430 
  431         <span class="n">CryoEMMapName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span>
  432         <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMVolumeID</span><span class="p">]</span>
  433         <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshID</span><span class="p">]</span>
  434         <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMSurfaceID</span><span class="p">]</span>
  435         <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupID</span><span class="p">]</span>
  436         <span class="n">CryoEMMeshGroupMembers</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span>
  437         
  438         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">,</span> <span class="n">CryoEMVolumeName</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span><span class="p">)</span>
  439         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  440 
  441         <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  442         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">,</span> <span class="n">CryoEMMeshName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span><span class="p">)</span>
  443         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  444         
  445         <span class="n">PML</span> <span class="o">=</span> <span class="n">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">,</span> <span class="n">CryoEMSurfaceName</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">],</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span><span class="p">)</span>
  446         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  447         
  448         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">CryoEMMeshGroupName</span><span class="p">,</span> <span class="n">CryoEMMeshGroupMembers</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span> <span class="s2">&quot;close&quot;</span><span class="p">)</span>
  449         
  450         <span class="c1"># Set up polar contacts...</span>
  451         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(Pocket|PocketSolvent|PocketInorganic)$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  452             <span class="n">PolarContactsID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">PolarContacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  453             <span class="n">PolarContactsName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">PolarContactsID</span><span class="p">]</span>
  454             
  455             <span class="n">PolarContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsLigandColor&quot;</span><span class="p">]</span>
  456             <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketSolvent$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  457                 <span class="n">PolarContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsSolventColor&quot;</span><span class="p">]</span>
  458             <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^PocketInorganic$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  459                 <span class="n">PolarContactsColor</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsInorganicColor&quot;</span><span class="p">]</span>
  460             
  461             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForPolarContactsView</span><span class="p">(</span><span class="n">PolarContactsName</span><span class="p">,</span> <span class="n">LigandName</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Color</span> <span class="o">=</span> <span class="n">PolarContactsColor</span><span class="p">)</span>
  462             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  463             
  464             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PolarContactsColor</span><span class="p">,</span> <span class="n">PolarContactsName</span><span class="p">))</span>
  465             
  466         <span class="c1"># Set up hydrophobic surface...</span>
  467         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="ow">and</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketSurface&quot;</span><span class="p">]:</span>
  468             <span class="n">HydrophobicSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">HydrophobicSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  469             <span class="n">HydrophobicSurfaceName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">HydrophobicSurfaceID</span><span class="p">]</span>
  470             <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForHydrophobicSurfaceView</span><span class="p">(</span><span class="n">HydrophobicSurfaceName</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">ColorPalette</span> <span class="o">=</span> <span class="s2">&quot;RedToWhite&quot;</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">)</span>
  471             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  472             
  473             <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.set(&quot;label_color&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketLabelColor&quot;</span><span class="p">],</span> <span class="n">HydrophobicSurfaceName</span><span class="p">))</span>
  474         
  475         <span class="c1"># Setup group....</span>
  476         <span class="n">GroupNameID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  477         <span class="n">GroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  478         <span class="n">GroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupNameID</span><span class="p">]</span>
  479         <span class="n">GroupMembers</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span>
  480 
  481         <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span>
  482         <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span>
  483         <span class="k">if</span>  <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^(Ligand|Pocket)$&quot;</span><span class="p">,</span> <span class="n">GroupID</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  484             <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;open&quot;</span>
  485             <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span>
  486         <span class="n">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">,</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  487 
  488 <span class="k">def</span> <span class="nf">GenerateAndWritePMLForGroup</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">Action</span> <span class="o">=</span> <span class="s2">&quot;close&quot;</span><span class="p">):</span>
  489     <span class="sd">&quot;&quot;&quot;Generate and write PML for group. &quot;&quot;&quot;</span>
  490     
  491     <span class="n">PML</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForGroup</span><span class="p">(</span><span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupMembers</span><span class="p">,</span> <span class="n">Enable</span><span class="p">,</span> <span class="n">Action</span><span class="p">)</span>
  492     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Setting up group </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="n">GroupName</span><span class="p">)</span>
  493     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  494 
  495 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensityMap</span><span class="p">(</span><span class="n">MapFileName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">AlignMapToObjectName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">):</span>
  496     <span class="sd">&quot;&quot;&quot;Setup PML for loading and viewing cryo-EM density map. &quot;&quot;&quot;</span>
  497 
  498     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  499     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.load(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MapFileName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">))</span>
  500     <span class="k">if</span> <span class="n">AlignMapToObjectName</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  501         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.matrix_copy(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">AlignMapToObjectName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">))</span>
  502         
  503     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  504     
  505     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  506     
  507     <span class="k">return</span> <span class="n">PML</span>
  508     
  509 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensityMesh</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  510     <span class="sd">&quot;&quot;&quot;Setup PML for cryo-EM density mesh. &quot;&quot;&quot;</span>
  511 
  512     <span class="n">Carve</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshCarveRadius&quot;</span><span class="p">]</span>
  513     
  514     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  515     <span class="k">if</span> <span class="n">Selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  516         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isomesh(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">))</span>
  517     <span class="k">else</span><span class="p">:</span>
  518         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isomesh(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">, &quot;(</span><span class="si">%s</span><span class="s2">)&quot;, carve = </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">Carve</span><span class="p">))</span>
  519     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">MeshName</span><span class="p">))</span>
  520     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">MeshName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  521     
  522     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  523     
  524     <span class="k">return</span> <span class="n">PML</span>
  525 
  526 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensityVolume</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  527     <span class="sd">&quot;&quot;&quot;Setup PML for cryo-EM density volume. &quot;&quot;&quot;</span>
  528 
  529     <span class="n">Carve</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeCarveRadius&quot;</span><span class="p">]</span>
  530     
  531     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  532     <span class="k">if</span> <span class="n">Selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  533         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">VolumeName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">))</span>
  534     <span class="k">else</span><span class="p">:</span>
  535         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.volume(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;(</span><span class="si">%s</span><span class="s2">)&quot;, carve = </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">VolumeName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">VolumeColorRamp</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">Carve</span><span class="p">))</span>
  536     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">VolumeName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  537     
  538     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  539     
  540     <span class="k">return</span> <span class="n">PML</span>
  541 
  542 <span class="k">def</span> <span class="nf">SetupPMLForCryoEMDensitySurface</span><span class="p">(</span><span class="n">MapName</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Color</span><span class="p">,</span> <span class="n">Enable</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">Selection</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  543     <span class="sd">&quot;&quot;&quot;Setup PML for cryo-EM density surface. &quot;&quot;&quot;</span>
  544 
  545     <span class="n">Carve</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshCarveRadius&quot;</span><span class="p">]</span>
  546     
  547     <span class="n">PMLCmds</span> <span class="o">=</span> <span class="p">[]</span>
  548     <span class="k">if</span> <span class="n">Selection</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  549         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isosurface(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SurfaceName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">))</span>
  550     <span class="k">else</span><span class="p">:</span>
  551         <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;cmd.isosurface(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;, </span><span class="si">%.1f</span><span class="s2">, &quot;(</span><span class="si">%s</span><span class="s2">)&quot;, carve = </span><span class="si">%.1f</span><span class="s2">)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SurfaceName</span><span class="p">,</span> <span class="n">MapName</span><span class="p">,</span> <span class="n">SigmaLevel</span><span class="p">,</span> <span class="n">Selection</span><span class="p">,</span> <span class="n">Carve</span><span class="p">))</span>
  552     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;util.color_deep(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Color</span><span class="p">,</span> <span class="n">SurfaceName</span><span class="p">))</span>
  553     <span class="n">PMLCmds</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">SetupPMLForEnableDisable</span><span class="p">(</span><span class="n">SurfaceName</span><span class="p">,</span> <span class="n">Enable</span><span class="p">))</span>
  554     
  555     <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PMLCmds</span><span class="p">)</span>
  556     
  557     <span class="k">return</span> <span class="n">PML</span>
  558 
  559 <span class="k">def</span> <span class="nf">GeneratePyMOLSessionFile</span><span class="p">():</span>
  560     <span class="sd">&quot;&quot;&quot;Generate PME file from PML file. &quot;&quot;&quot;</span>
  561 
  562     <span class="n">PSEOutfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOutfile&quot;</span><span class="p">]</span>
  563     <span class="n">PMLOutfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span>
  564     
  565     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Generating file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">PSEOutfile</span><span class="p">)</span>
  566     
  567     <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">ConvertPMLFileToPSEFile</span><span class="p">(</span><span class="n">PMLOutfile</span><span class="p">,</span> <span class="n">PSEOutfile</span><span class="p">)</span>
  568     
  569     <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">PSEOutfile</span><span class="p">):</span>
  570         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to generate PSE file, </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PSEOutfile</span><span class="p">))</span>
  571     
  572     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOut&quot;</span><span class="p">]:</span>
  573         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Deleting file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">PMLOutfile</span><span class="p">)</span>
  574         <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">PMLOutfile</span><span class="p">)</span>
  575 
  576 <span class="k">def</span> <span class="nf">DeleteEmptyPyMOLObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  577     <span class="sd">&quot;&quot;&quot;Delete empty PyMOL objects. &quot;&quot;&quot;</span>
  578     
  579     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AllowEmptyObjects&quot;</span><span class="p">]:</span>
  580         <span class="k">return</span>
  581     
  582     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  583     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
  584         <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;Checking and deleting empty objects for chain </span><span class="si">%s</span><span class="s2">...&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;</span><span class="se">\n</span><span class="s2">&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">))</span>
  585         
  586         <span class="c1"># Delete any chain level objects...</span>
  587         <span class="n">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Solvent&quot;</span><span class="p">])</span>
  588         <span class="n">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;Inorganic&quot;</span><span class="p">])</span>
  589         
  590         <span class="k">for</span> <span class="n">LigandID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]:</span>
  591             <span class="c1"># Delete ligand level objects...</span>
  592             <span class="k">for</span> <span class="n">GroupID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Pocket&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketSolvent&quot;</span><span class="p">,</span> <span class="s2">&quot;PocketInorganic&quot;</span><span class="p">]:</span>
  593                 <span class="n">GroupNameID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  594                 <span class="n">GroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupNameID</span><span class="p">]</span>
  595 
  596                 <span class="n">GroupTypeObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  597                 <span class="n">GroupTypeObjectName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupTypeObjectID</span><span class="p">]</span>
  598                 
  599                 <span class="n">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">GroupTypeObjectName</span><span class="p">,</span> <span class="n">GroupName</span><span class="p">)</span>
  600 
  601 <span class="k">def</span> <span class="nf">WritePMLToCheckAndDeleteEmptyObjects</span><span class="p">(</span><span class="n">OutFH</span><span class="p">,</span> <span class="n">ObjectName</span><span class="p">,</span> <span class="n">ParentObjectName</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
  602     <span class="sd">&quot;&quot;&quot;Write PML to check and delete empty PyMOL objects. &quot;&quot;&quot;</span>
  603     
  604     <span class="k">if</span> <span class="n">ParentObjectName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  605         <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CheckAndDeleteEmptyObjects(&quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ObjectName</span><span class="p">)</span>
  606     <span class="k">else</span><span class="p">:</span>
  607         <span class="n">PML</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;CheckAndDeleteEmptyObjects(&quot;</span><span class="si">%s</span><span class="s2">&quot;, &quot;</span><span class="si">%s</span><span class="s2">&quot;)&quot;&quot;&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ObjectName</span><span class="p">,</span> <span class="n">ParentObjectName</span><span class="p">)</span>
  608     
  609     <span class="n">OutFH</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PML</span><span class="p">)</span>
  610 
  611 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNames</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">):</span>
  612     <span class="sd">&quot;&quot;&quot;Setup hierarchy of PyMOL groups and objects for ligand centric views of</span>
  613 <span class="sd">    cryo-EM density for chains and ligands present in input file.</span>
  614 <span class="sd">    &quot;&quot;&quot;</span>
  615 
  616     <span class="n">PyMOLObjectNames</span> <span class="o">=</span> <span class="p">{}</span>
  617     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  618     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  619 
  620     <span class="c1"># Setup groups and objects for complex...</span>
  621     <span class="n">SetupPyMOLObjectNamesForComplex</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">)</span>
  622     
  623     <span class="c1"># Setup groups and objects for chain...</span>
  624     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  625     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
  626         <span class="n">SetupPyMOLObjectNamesForChain</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  627         
  628         <span class="c1"># Setup groups and objects for ligand...</span>
  629         <span class="k">for</span> <span class="n">LigandID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]:</span>
  630             <span class="n">SetupPyMOLObjectNamesForLigand</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">)</span>
  631 
  632     <span class="k">return</span> <span class="n">PyMOLObjectNames</span>
  633 
  634 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForComplex</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">):</span>
  635     <span class="sd">&quot;&quot;&quot;Stetup groups and objects for complex. &quot;&quot;&quot;</span>
  636     
  637     <span class="n">PDBFileRoot</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesRoots&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  638     
  639     <span class="n">PDBGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">PDBFileRoot</span>
  640     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">PDBGroupName</span>
  641     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  642 
  643     <span class="n">ComplexGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">]</span>
  644     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ComplexGroupName</span>
  645     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ComplexGroupName</span><span class="p">)</span>
  646     
  647     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="n">ComplexGroupName</span>
  648 
  649     <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ComplexGroupName</span><span class="p">)</span>
  650     <span class="n">CryoEMMapName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Map&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  651     <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  652     <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  653     <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  654     
  655     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  656     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMapName</span>
  657     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  658     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMMesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  659     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMSurface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  660 
  661     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  662     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMapName</span><span class="p">)</span>
  663     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]:</span>
  664         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  665     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]:</span>
  666         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  667     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]:</span>
  668         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  669     
  670     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  671     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Complex&quot;</span><span class="p">])</span>
  672     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;ComplexCryoEMGroup&quot;</span><span class="p">])</span>
  673     
  674 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForChain</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">):</span>
  675     <span class="sd">&quot;&quot;&quot;Setup groups and objects for chain.&quot;&quot;&quot;</span>
  676     
  677     <span class="n">PDBGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroup&quot;</span><span class="p">]</span>
  678     
  679     <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
  680     <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  681     <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  682     <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span>
  683     
  684     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  685     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  686     
  687     <span class="c1"># Set up chain group and chain objects...</span>
  688     <span class="n">ChainGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Chain</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">PDBGroupName</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">)</span>
  689     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainGroupName</span>
  690     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;PDBGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainGroupName</span><span class="p">)</span>
  691     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  692     
  693     <span class="c1"># Setup chain complex group and objects...</span>
  694     <span class="n">ChainComplexGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">)</span>
  695     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainComplexGroupName</span>
  696     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainComplexGroupName</span><span class="p">)</span>
  697     
  698     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Complex&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainComplexGroupName</span><span class="p">)</span>
  699     
  700     <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainComplexGroupName</span><span class="p">)</span>
  701     <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  702     <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  703     <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  704     
  705     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  706     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMVolume&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  707     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMMesh&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  708     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMSurface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  709     
  710     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  711     <span class="k">if</span> <span class="n">VolumeChainComplex</span><span class="p">:</span>
  712         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  713     <span class="k">if</span> <span class="n">MeshChainComplex</span><span class="p">:</span>
  714         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  715     <span class="k">if</span> <span class="n">SurfaceChainComplex</span><span class="p">:</span>
  716         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexCryoEMGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  717     
  718     <span class="n">NameIDs</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;ChainComplex&quot;</span><span class="p">]</span>
  719     <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">or</span> <span class="n">VolumeChainComplex</span> <span class="ow">or</span> <span class="n">SurfaceChainComplex</span> <span class="p">:</span>
  720         <span class="n">NameIDs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;ChainComplexCryoEMGroup&quot;</span><span class="p">)</span>
  721     
  722     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  723     <span class="k">for</span> <span class="n">NameID</span> <span class="ow">in</span> <span class="n">NameIDs</span><span class="p">:</span>
  724         <span class="n">Name</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">NameID</span><span class="p">]</span>
  725         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainComplexGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  726 
  727     <span class="c1"># Setup up a group for individual chains...</span>
  728     <span class="n">ChainAloneGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Chain&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">)</span>
  729     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainAloneGroupName</span>
  730     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  731         
  732     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  733         
  734     <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Chain&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  735     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAlone&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
  736     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  737         
  738     <span class="k">if</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorChainCartoonPutty&quot;</span><span class="p">]:</span>
  739         <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.BFactor&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainAloneGroupName</span><span class="p">)</span>
  740         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneBFactorPutty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
  741         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainAloneGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  742     
  743     <span class="c1"># Setup solvent and inorganic objects for chain...</span>
  744     <span class="k">for</span> <span class="n">NameID</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Solvent&quot;</span><span class="p">,</span> <span class="s2">&quot;Inorganic&quot;</span><span class="p">]:</span>
  745         <span class="n">Name</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">,</span> <span class="n">NameID</span><span class="p">)</span>
  746         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">NameID</span><span class="p">]</span> <span class="o">=</span> <span class="n">Name</span>
  747         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  748 
  749 <span class="k">def</span> <span class="nf">SetupPyMOLObjectNamesForLigand</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">,</span> <span class="n">PyMOLObjectNames</span><span class="p">,</span> <span class="n">ChainID</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">):</span>
  750     <span class="sd">&quot;&quot;&quot;Stetup groups and objects for ligand.&quot;&quot;&quot;</span>
  751 
  752     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
  753     
  754     <span class="n">ChainGroupName</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroup&quot;</span><span class="p">]</span>
  755     
  756     <span class="c1"># Setup a chain level ligand group...</span>
  757     <span class="n">ChainLigandGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Ligand</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainGroupName</span><span class="p">,</span> <span class="n">LigandID</span><span class="p">)</span>
  758     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainLigandGroupName</span>
  759     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Chains&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="s2">&quot;ChainGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainLigandGroupName</span><span class="p">)</span>
  760     
  761     <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroupMembers&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  762 
  763     <span class="c1"># Set up groups and objects for a specific ligand group...</span>
  764     <span class="k">for</span> <span class="n">GroupType</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;Ligand&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket_Solvent&quot;</span><span class="p">,</span> <span class="s2">&quot;Pocket_Inorganic&quot;</span><span class="p">]:</span>
  765         <span class="n">GroupID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">)</span>
  766         <span class="n">GroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainLigandGroupName</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">)</span>
  767                 
  768         <span class="n">GroupNameID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">Group&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  769         <span class="n">GroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">GroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  770         
  771         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupNameID</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupName</span>
  772         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="s2">&quot;ChainLigandGroupMembers&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  773         
  774         <span class="n">GroupTypeObjectName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">)</span>
  775         <span class="n">GroupTypeObjectID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  776         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupTypeObjectID</span><span class="p">]</span> <span class="o">=</span> <span class="n">GroupTypeObjectName</span>
  777         
  778         <span class="n">CryoEMMeshGroupName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.CryoEM&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  779         <span class="n">CryoEMVolumeName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Volume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  780         <span class="n">CryoEMMeshName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Mesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  781         <span class="n">CryoEMSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">CryoEMMeshGroupName</span><span class="p">)</span>
  782                 
  783         <span class="n">CryoEMMeshGroupID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroup&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  784         <span class="n">CryoEMMeshGroupMembersID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMeshGroupMembers&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  785         <span class="n">CryoEMVolumeID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMVolume&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  786         <span class="n">CryoEMMeshID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMMesh&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  787         <span class="n">CryoEMSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">CryoEMSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  788         
  789         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshGroupName</span>
  790         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMVolumeID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMVolumeName</span>
  791         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMMeshName</span>
  792         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMSurfaceID</span><span class="p">]</span> <span class="o">=</span> <span class="n">CryoEMSurfaceName</span>
  793         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  794         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMVolumeName</span><span class="p">)</span>
  795         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMMeshName</span><span class="p">)</span>
  796         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">CryoEMMeshGroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">CryoEMSurfaceName</span><span class="p">)</span>
  797                 
  798         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  799         <span class="n">NameIDs</span> <span class="o">=</span> <span class="p">[</span><span class="n">GroupTypeObjectID</span><span class="p">,</span> <span class="n">CryoEMMeshGroupID</span><span class="p">]</span>
  800         
  801         <span class="k">for</span> <span class="n">NameID</span> <span class="ow">in</span> <span class="n">NameIDs</span><span class="p">:</span>
  802             <span class="n">Name</span> <span class="o">=</span> <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">NameID</span><span class="p">]</span>
  803             <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Name</span><span class="p">)</span>
  804         
  805         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Ligand$&quot;</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  806             <span class="c1"># No other object needed for Ligand group...</span>
  807             <span class="k">continue</span>
  808         
  809         <span class="n">PolarContactsName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Polar_Contacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  810         <span class="n">PolarContactsID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">PolarContacts&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  811         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">PolarContactsID</span><span class="p">]</span> <span class="o">=</span> <span class="n">PolarContactsName</span>
  812         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">PolarContactsName</span><span class="p">)</span>
  813                 
  814         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Pocket$&quot;</span><span class="p">,</span> <span class="n">GroupType</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  815             <span class="c1"># No other object needed for any other group besides Pocket...</span>
  816             <span class="k">continue</span>
  817         
  818         <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketSurface&quot;</span><span class="p">]:</span>
  819             <span class="k">continue</span>
  820         
  821         <span class="n">HydrophobicSurfaceName</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.Surface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupName</span><span class="p">)</span>
  822         <span class="n">HydrophobicSurfaceID</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">HydrophobicSurface&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">GroupID</span><span class="p">)</span>
  823         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">HydrophobicSurfaceID</span><span class="p">]</span> <span class="o">=</span> <span class="n">HydrophobicSurfaceName</span>
  824         <span class="n">PyMOLObjectNames</span><span class="p">[</span><span class="s2">&quot;Ligands&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">][</span><span class="n">LigandID</span><span class="p">][</span><span class="n">GroupMembersID</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">HydrophobicSurfaceName</span><span class="p">)</span>
  825 
  826 <span class="k">def</span> <span class="nf">ProcessDensityMapFiles</span><span class="p">():</span>
  827     <span class="sd">&quot;&quot;&quot;Process density map files.&quot;&quot;&quot;</span>
  828     
  829     <span class="n">DensityMapFiles</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFiles&quot;</span><span class="p">]</span>
  830     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">DensityMapFiles</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  831         <span class="n">ProcessAutoDensityMapFiles</span><span class="p">()</span>
  832     <span class="k">else</span><span class="p">:</span>
  833         <span class="n">ProcessSpecifiedDensityMapFiles</span><span class="p">()</span>
  834         
  835 <span class="k">def</span> <span class="nf">ProcessSpecifiedDensityMapFiles</span><span class="p">():</span>
  836     <span class="sd">&quot;&quot;&quot;Process specified density map files.&quot;&quot;&quot;</span>
  837     
  838     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  839     
  840     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing cryo-EM density file names...&quot;</span><span class="p">)</span>
  841     
  842     <span class="n">DensityMapFiles</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFiles&quot;</span><span class="p">])</span>
  843     <span class="k">if</span> <span class="ow">not</span> <span class="n">DensityMapFiles</span><span class="p">:</span>
  844         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid value specified using </span><span class="se">\&quot;</span><span class="s2">--densityMapFiles</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span><span class="p">)</span>
  845     
  846     <span class="n">DensityMapFilesWords</span> <span class="o">=</span> <span class="n">DensityMapFiles</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
  847     <span class="n">DensityMapFilesWordsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">DensityMapFilesWords</span><span class="p">)</span>
  848     
  849     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
  850     
  851     <span class="k">if</span> <span class="n">DensityMapFilesWordsCount</span> <span class="o">!=</span> <span class="n">InfilesNamesCount</span><span class="p">:</span>
  852         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited cryo-EM density map files, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--DensityMapFiles</span><span class="se">\&quot;</span><span class="s2"> must be equal to the number of input files, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">-i, --infiles</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DensityMapFilesWordsCount</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">))</span>
  853     
  854     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
  855         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
  856         <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">DensityMapFilesWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
  857         
  858         <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">DensityMapFile</span><span class="p">):</span>
  859             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The cryo-EM density ED map file, </span><span class="si">%s</span><span class="s2">, specified using option </span><span class="se">\&quot;</span><span class="s2">--DensityMapFiles</span><span class="se">\&quot;</span><span class="s2">, corresponding to input file, </span><span class="si">%s</span><span class="s2">,  doesn&#39;t exist.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DensityMapFile</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
  860         
  861         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DensityMapFile</span><span class="p">)</span>
  862     
  863 <span class="k">def</span> <span class="nf">ProcessAutoDensityMapFiles</span><span class="p">():</span>
  864     <span class="sd">&quot;&quot;&quot;Set up and process name of density map files.&quot;&quot;&quot;</span>
  865     
  866     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
  867     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
  868 
  869     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting cryo-EM density file names...&quot;</span><span class="p">)</span>
  870     
  871     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
  872         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
  873         
  874         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetrieveEMDBID</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
  875         <span class="k">if</span> <span class="n">EMDBID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  876             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve EMDB ID from input file </span><span class="si">%s</span><span class="s2"> to automatically set density map file name. Use option </span><span class="se">\&quot;</span><span class="s2">-d, --densityMapFiles </span><span class="se">\&quot;</span><span class="s2"> to specify density map file name and try again.&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
  877         
  878         <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="bp">None</span>
  879         <span class="n">MapFileRoot</span> <span class="o">=</span> <span class="s2">&quot;emd_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">EMDBID</span>
  880         <span class="n">MapFile1</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.map.gz&quot;</span> <span class="o">%</span> <span class="n">MapFileRoot</span>
  881         <span class="n">MapFile2</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">%s</span><span class="s2">.map&quot;</span> <span class="o">%</span> <span class="n">MapFileRoot</span>
  882         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MapFile1</span><span class="p">):</span>
  883             <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">MapFile1</span>
  884         <span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MapFile2</span><span class="p">):</span>
  885             <span class="n">DensityMapFile</span> <span class="o">=</span> <span class="n">MapFile2</span>
  886         <span class="k">else</span><span class="p">:</span>
  887             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Density map files </span><span class="si">%s</span><span class="s2"> or </span><span class="si">%s</span><span class="s2"> don&#39;t exist. Use option </span><span class="se">\&quot;</span><span class="s2">-d, --densityMapFiles </span><span class="se">\&quot;</span><span class="s2"> to specify density map file name and try again&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MapFile1</span><span class="p">,</span> <span class="n">MapFile2</span><span class="p">))</span>
  888     
  889         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Setting density map file name as </span><span class="si">%s</span><span class="s2"> for input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">DensityMapFile</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
  890         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFilesNames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">DensityMapFile</span><span class="p">)</span>
  891         
  892 <span class="k">def</span> <span class="nf">RetrieveRecommededContourLevel</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
  893     <span class="sd">&quot;&quot;&quot;Retrieve recommened contour level.&quot;&quot;&quot;</span>
  894 
  895     <span class="k">if</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">]:</span>
  896         <span class="n">RecommendedContourLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span>
  897         <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
  898     
  899     <span class="n">RecommendedContourLevel</span> <span class="o">=</span> <span class="bp">None</span>
  900     <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetrieveEMDBID</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
  901     <span class="k">if</span> <span class="n">EMDBID</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  902         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve EMDB ID from input file </span><span class="si">%s</span><span class="s2"> to detect local header file already downloaded from EMDB server...&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
  903         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecommendedContourLevel</span>
  904         <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
  905 
  906     <span class="n">MetadataHeaderFile</span> <span class="o">=</span> <span class="s2">&quot;emd-</span><span class="si">%s</span><span class="s2">.xml&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">EMDBID</span><span class="p">)</span>
  907     <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">):</span>
  908         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to find a local header file, </span><span class="si">%s</span><span class="s2">, for EMDB ID </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">,</span> <span class="n">EMDBID</span><span class="p">))</span>
  909         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecommendedContourLevel</span>
  910         <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
  911 
  912     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving recommeded contour level from header file, </span><span class="si">%s</span><span class="s2">, for input file, </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
  913 
  914     <span class="n">ContourLevel</span> <span class="o">=</span> <span class="bp">None</span>
  915     <span class="n">Source</span> <span class="o">=</span> <span class="bp">None</span>
  916     <span class="n">XMLTree</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">MetadataHeaderFile</span><span class="p">)</span>
  917     <span class="n">XMLRoot</span> <span class="o">=</span> <span class="n">XMLTree</span><span class="o">.</span><span class="n">getroot</span><span class="p">()</span>
  918 
  919     <span class="n">MapElement</span> <span class="o">=</span> <span class="n">XMLTree</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;map&quot;</span><span class="p">)</span>
  920     <span class="k">if</span> <span class="n">MapElement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  921         <span class="n">ContourLevelElement</span> <span class="o">=</span> <span class="n">MapElement</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;contourLevel&quot;</span><span class="p">)</span>
  922         <span class="k">if</span> <span class="n">ContourLevelElement</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  923             <span class="n">ContourLevel</span> <span class="o">=</span> <span class="n">ContourLevelElement</span><span class="o">.</span><span class="n">text</span>
  924             <span class="n">Source</span> <span class="o">=</span> <span class="n">ContourLevelElement</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">)</span>
  925 
  926     <span class="k">if</span> <span class="n">ContourLevel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
  927         <span class="k">if</span> <span class="n">Source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  928             <span class="n">Source</span> <span class="o">=</span> <span class="s2">&quot;NA&quot;</span>
  929         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Retrieved recommended (Source: </span><span class="si">%s</span><span class="s2">) contour level </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Source</span><span class="p">,</span> <span class="n">ContourLevel</span><span class="p">))</span>
  930         <span class="n">RecommendedContourLevel</span> <span class="o">=</span> <span class="n">ContourLevel</span>
  931     
  932     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">RecommendedContourLevel</span>
  933     
  934     <span class="k">return</span> <span class="n">RecommendedContourLevel</span>
  935 
  936 <span class="k">def</span> <span class="nf">RetrieveEMDBID</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
  937     <span class="sd">&quot;&quot;&quot;Retrieve EMDB ID from input file. &quot;&quot;&quot;</span>
  938 
  939     <span class="k">if</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">]:</span>
  940         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span>
  941         <span class="k">return</span> <span class="n">EMDBID</span>
  942     
  943     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
  944     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
  945 
  946     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^pdb$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  947         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetriveEMDBIDFromPDBFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
  948     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^cif$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  949         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">RetriveEMDBIDFromCIFFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
  950     <span class="k">else</span><span class="p">:</span>
  951         <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
  952 
  953     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">][</span><span class="n">Infile</span><span class="p">]</span> <span class="o">=</span> <span class="n">EMDBID</span>
  954     
  955     <span class="k">return</span> <span class="n">EMDBID</span>
  956 
  957 <span class="k">def</span> <span class="nf">RetriveEMDBIDFromPDBFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
  958     <span class="sd">&quot;&quot;&quot;Retrieve EMDB ID from PDB file. &quot;&quot;&quot;</span>
  959 
  960     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
  961     <span class="n">InfileFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
  962     <span class="k">if</span> <span class="n">InfileFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  963         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open input file: </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Infile</span><span class="p">))</span>
  964 
  965     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving EMDB ID from input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
  966     
  967     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
  968     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">InfileFH</span><span class="p">:</span>
  969         <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
  970         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^REMARK&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  971             <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;DB: EMDB&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  972                 <span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
  973                     <span class="c1"># Retrieve string with EMD-</span>
  974                     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  975                         <span class="n">Word</span> <span class="o">=</span> <span class="n">Word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  976                         <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">)</span>
  977                         <span class="k">break</span>
  978                 <span class="k">break</span>
  979     <span class="n">InfileFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
  980     
  981     <span class="k">return</span> <span class="n">EMDBID</span>
  982 
  983 <span class="k">def</span> <span class="nf">RetriveEMDBIDFromCIFFile</span><span class="p">(</span><span class="n">Infile</span><span class="p">):</span>
  984     <span class="sd">&quot;&quot;&quot;Retrieve EMDB ID from CIF file. &quot;&quot;&quot;</span>
  985 
  986     <span class="n">InfileFH</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span>
  987     <span class="k">if</span> <span class="n">InfileFH</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
  988         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;Couldn&#39;t open input file: </span><span class="si">%s</span><span class="s2">.</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">Infile</span><span class="p">))</span>
  989 
  990     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving EMDB ID from input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">Infile</span><span class="p">)</span>
  991     
  992     <span class="n">EMDBID</span> <span class="o">=</span> <span class="bp">None</span>
  993     <span class="k">for</span> <span class="n">Line</span> <span class="ow">in</span> <span class="n">InfileFH</span><span class="p">:</span>
  994         <span class="n">Line</span> <span class="o">=</span> <span class="n">Line</span><span class="o">.</span><span class="n">rstrip</span><span class="p">()</span>
  995         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^EMDB  EMD&quot;</span><span class="p">,</span> <span class="n">Line</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  996             <span class="k">for</span> <span class="n">Word</span> <span class="ow">in</span> <span class="n">Line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">):</span>
  997                 <span class="c1"># Retrieve string with EMD-</span>
  998                 <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
  999                     <span class="n">Word</span> <span class="o">=</span> <span class="n">Word</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 1000                     <span class="n">EMDBID</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;EMD-&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">Word</span><span class="p">)</span>
 1001                     <span class="k">break</span>
 1002             <span class="k">break</span>
 1003     <span class="n">InfileFH</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
 1004     
 1005     <span class="k">return</span> <span class="n">EMDBID</span>
 1006 
 1007 <span class="k">def</span> <span class="nf">RetrieveInfilesInfo</span><span class="p">():</span>
 1008     <span class="sd">&quot;&quot;&quot;Retrieve information for input files.&quot;&quot;&quot;</span>
 1009 
 1010     <span class="n">InfilesInfo</span> <span class="o">=</span> <span class="p">{}</span>
 1011     
 1012     <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1013     <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRoots&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1014     <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1015     
 1016     <span class="k">for</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]:</span>
 1017         <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1018         <span class="n">InfileRoot</span> <span class="o">=</span> <span class="n">FileName</span>
 1019         
 1020         <span class="n">ChainsAndLigandInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">GetChainsAndLigandsInfo</span><span class="p">(</span><span class="n">Infile</span><span class="p">,</span> <span class="n">InfileRoot</span><span class="p">)</span>
 1021         
 1022         <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1023         <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRoots&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">InfileRoot</span><span class="p">)</span>
 1024         <span class="n">InfilesInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ChainsAndLigandInfo</span><span class="p">)</span>
 1025     
 1026     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">InfilesInfo</span>
 1027 
 1028 <span class="k">def</span> <span class="nf">RetrieveRefFileInfo</span><span class="p">():</span>
 1029     <span class="sd">&quot;&quot;&quot;Retrieve information for ref file.&quot;&quot;&quot;</span>
 1030 
 1031     <span class="n">RefFileInfo</span> <span class="o">=</span> <span class="p">{}</span>
 1032     <span class="k">if</span> <span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]:</span>
 1033         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFileInfo</span>
 1034         <span class="k">return</span>
 1035 
 1036     <span class="n">RefFile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span>
 1037     
 1038     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">RefFile</span><span class="p">)</span>
 1039     <span class="n">RefFileRoot</span> <span class="o">=</span> <span class="n">FileName</span>
 1040     
 1041     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1042         <span class="n">ChainsAndLigandInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1043     <span class="k">else</span><span class="p">:</span>
 1044         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Retrieving chain and ligand information for alignment reference file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">RefFile</span><span class="p">)</span>
 1045         <span class="n">ChainsAndLigandInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">GetChainsAndLigandsInfo</span><span class="p">(</span><span class="n">RefFile</span><span class="p">,</span> <span class="n">RefFileRoot</span><span class="p">)</span>
 1046 
 1047     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFile</span>
 1048     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;RefFileRoot&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFileRoot</span>
 1049     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;PyMOLObjectName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;AlignRef_</span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">RefFileRoot</span>
 1050     <span class="n">RefFileInfo</span><span class="p">[</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ChainsAndLigandInfo</span>
 1051     
 1052     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">RefFileInfo</span>
 1053 
 1054 <span class="k">def</span> <span class="nf">ProcessChainAndLigandIDs</span><span class="p">():</span>
 1055     <span class="sd">&quot;&quot;&quot;Process specified chain and ligand IDs for infiles.&quot;&quot;&quot;</span>
 1056     
 1057     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1058     
 1059     <span class="k">for</span> <span class="n">FileIndex</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])):</span>
 1060         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing specified chain and ligand IDs for input file </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">])</span>
 1061         
 1062         <span class="n">ChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
 1063         <span class="n">SpecifiedChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">PyMOLUtil</span><span class="o">.</span><span class="n">ProcessChainsAndLigandsOptionsInfo</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">,</span> <span class="s2">&quot;-c, --chainIDs&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">],</span> <span class="s2">&quot;-l, --ligandIDs&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">])</span>
 1064         <span class="n">ProcessChainMeshesVolumesAndSurfacesOptions</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">)</span>
 1065         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;SpecifiedChainsAndLigandsInfo&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">)</span>
 1066         
 1067         <span class="n">CheckPresenceOfValidLigandIDs</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">,</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">)</span>
 1068         
 1069 <span class="k">def</span> <span class="nf">CheckPresenceOfValidLigandIDs</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">,</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">):</span>
 1070     <span class="sd">&quot;&quot;&quot;Check presence of valid ligand IDs.&quot;&quot;&quot;</span>
 1071 
 1072     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Specified chain IDs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">])))</span>
 1073     
 1074     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
 1075         <span class="k">if</span> <span class="nb">len</span> <span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]):</span>
 1076             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Chain ID: </span><span class="si">%s</span><span class="s2">; Specified LigandIDs: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">,</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">])))</span>
 1077         <span class="k">else</span><span class="p">:</span>
 1078             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Chain IDs: </span><span class="si">%s</span><span class="s2">; Specified LigandIDs: None&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">))</span>
 1079             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;No valid ligand IDs found for chain ID, </span><span class="si">%s</span><span class="s2">. PyMOL groups and objects related to ligand and binding pockect won&#39;t be created.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ChainID</span><span class="p">))</span>
 1080 
 1081 <span class="k">def</span> <span class="nf">RetrieveFirstChainID</span><span class="p">(</span><span class="n">FileIndex</span><span class="p">):</span>
 1082     <span class="sd">&quot;&quot;&quot;Get first chain ID.&quot;&quot;&quot;</span>
 1083     
 1084     <span class="n">ChainsAndLigandsInfo</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesInfo&quot;</span><span class="p">][</span><span class="s2">&quot;ChainsAndLigandsInfo&quot;</span><span class="p">][</span><span class="n">FileIndex</span><span class="p">]</span>
 1085     
 1086     <span class="n">FirstChainID</span> <span class="o">=</span> <span class="bp">None</span>
 1087     <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">ChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]):</span>
 1088         <span class="n">FirstChainID</span> <span class="o">=</span> <span class="n">ChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1089     
 1090     <span class="k">return</span> <span class="n">FirstChainID</span>
 1091 
 1092 <span class="k">def</span> <span class="nf">ProcessChainMeshesVolumesAndSurfacesOptions</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">):</span>
 1093     <span class="sd">&quot;&quot;&quot;Process options to create meshes and surfaces for chains.&quot;&quot;&quot;</span>
 1094 
 1095     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1096     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1097     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1098 
 1099     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableVolumeChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1100     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableMeshChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1101     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableSurfaceChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1102     
 1103     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainComplexGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1104     <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainAloneGroup&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
 1105     
 1106     <span class="k">for</span> <span class="n">ChainID</span> <span class="ow">in</span> <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]:</span>
 1107         <span class="n">LigandsPresent</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">])</span> <span class="k">else</span> <span class="bp">False</span>
 1108 
 1109         <span class="c1"># Create and enable mesh  or volume in auto mode...</span>
 1110         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1111             <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1112             <span class="n">EnableMeshChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1113         <span class="k">else</span><span class="p">:</span>
 1114             <span class="n">MeshChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1115             <span class="n">EnableMeshChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1116         
 1117         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1118             <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1119             <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1120         <span class="k">else</span><span class="p">:</span>
 1121             <span class="n">VolumeChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1122             <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1123         
 1124         <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">and</span> <span class="n">EnableMeshChainComplex</span><span class="p">:</span>
 1125             <span class="n">EnableVolumeChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1126         
 1127         <span class="c1"># Create and enable surface in auto mode based on the status of mesh and volume...</span>
 1128         <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1129             <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1130             <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span> <span class="k">if</span> <span class="n">LigandsPresent</span> <span class="k">else</span> <span class="bp">True</span>
 1131             
 1132             <span class="k">if</span> <span class="n">MeshChainComplex</span> <span class="ow">or</span> <span class="n">VolumeChainComplex</span><span class="p">:</span>
 1133                 <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1134                 <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1135         <span class="k">else</span><span class="p">:</span>
 1136             <span class="n">SurfaceChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1137             <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1138         
 1139         <span class="k">if</span> <span class="p">(</span><span class="n">MeshChainComplex</span> <span class="ow">and</span> <span class="n">EnableMeshChainComplex</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">VolumeChainComplex</span> <span class="ow">or</span> <span class="n">EnableVolumeChainComplex</span><span class="p">):</span>
 1140             <span class="n">EnableSurfaceChainComplex</span> <span class="o">=</span> <span class="bp">False</span>
 1141             
 1142         <span class="k">if</span> <span class="n">LigandsPresent</span><span class="p">:</span>
 1143             <span class="n">EnableChainComplexGroup</span> <span class="o">=</span> <span class="bp">False</span>
 1144             <span class="n">EnableChainAloneGroup</span> <span class="o">=</span> <span class="bp">True</span>
 1145         <span class="k">else</span><span class="p">:</span>
 1146             <span class="n">EnableChainComplexGroup</span> <span class="o">=</span> <span class="bp">True</span>
 1147             <span class="n">EnableChainAloneGroup</span> <span class="o">=</span> <span class="bp">False</span>
 1148 
 1149         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">VolumeChainComplex</span>
 1150         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">MeshChainComplex</span>
 1151         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">SurfaceChainComplex</span>
 1152         
 1153         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableVolumeChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableVolumeChainComplex</span>
 1154         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableMeshChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableMeshChainComplex</span>
 1155         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableSurfaceChainComplex&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableSurfaceChainComplex</span>
 1156         
 1157         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainComplexGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableChainComplexGroup</span>
 1158         <span class="n">SpecifiedChainsAndLigandsInfo</span><span class="p">[</span><span class="s2">&quot;EnableChainAloneGroup&quot;</span><span class="p">][</span><span class="n">ChainID</span><span class="p">]</span> <span class="o">=</span> <span class="n">EnableChainAloneGroup</span>
 1159 
 1160 <span class="k">def</span> <span class="nf">ProcessMeshLevel</span><span class="p">():</span>
 1161     <span class="sd">&quot;&quot;&quot;Process mesh level.&quot;&quot;&quot;</span>
 1162     
 1163     <span class="n">MeshLevel</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevel&quot;</span><span class="p">]</span>
 1164     
 1165     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">MeshLevel</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1166         <span class="n">ProcessAutoMeshLevel</span><span class="p">()</span>
 1167     <span class="k">else</span><span class="p">:</span>
 1168         <span class="n">ProcessSpecifiedMeshLevel</span><span class="p">()</span>
 1169 
 1170 <span class="k">def</span> <span class="nf">ProcessAutoMeshLevel</span><span class="p">():</span>
 1171     <span class="sd">&quot;&quot;&quot;Process auto mesh level.&quot;&quot;&quot;</span>
 1172     
 1173     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1174     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
 1175     
 1176     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting mesh levels...&quot;</span><span class="p">)</span>
 1177     
 1178     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
 1179         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
 1180         
 1181         <span class="n">RecommededContourLevel</span> <span class="o">=</span> <span class="n">RetrieveRecommededContourLevel</span><span class="p">(</span><span class="n">Infile</span><span class="p">)</span>
 1182         <span class="k">if</span> <span class="n">RecommededContourLevel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1183             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve recommended mesh contour level from header. It&#39;s being set to 1.0. Use </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> option to specify a different contour mesh level.&quot;</span><span class="p">)</span>
 1184             <span class="n">MeshLevel</span> <span class="o">=</span> <span class="mf">1.0</span>
 1185         <span class="k">else</span><span class="p">:</span>
 1186             <span class="n">MeshLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">RecommededContourLevel</span><span class="p">)</span>
 1187         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">)</span>
 1188         
 1189 <span class="k">def</span> <span class="nf">ProcessSpecifiedMeshLevel</span><span class="p">():</span>
 1190     <span class="sd">&quot;&quot;&quot;Process specified mesh level.&quot;&quot;&quot;</span>
 1191 
 1192     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing mesh levels...&quot;</span><span class="p">)</span>
 1193     
 1194     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
 1195     <span class="n">InfilesNamesCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">])</span>
 1196     
 1197     <span class="n">MeshLevels</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevel&quot;</span><span class="p">])</span>
 1198     <span class="k">if</span> <span class="ow">not</span> <span class="n">MeshLevels</span><span class="p">:</span>
 1199         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No valid value specified using </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span><span class="p">)</span>
 1200     
 1201     <span class="n">MeshLevelWords</span> <span class="o">=</span> <span class="n">MeshLevels</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>
 1202     <span class="n">MeshLevelWordsCount</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">MeshLevelWords</span><span class="p">)</span>
 1203     
 1204     <span class="k">if</span> <span class="n">MeshLevelWordsCount</span> <span class="o">!=</span> <span class="n">InfilesNamesCount</span><span class="p">:</span>
 1205         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The number of comma delimited mesh levels, </span><span class="si">%d</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> must be equal to the number of input files, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">-i, --infiles</span><span class="se">\&quot;</span><span class="s2"> option.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshLevelWordsCount</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">))</span>
 1206     
 1207     <span class="k">for</span> <span class="n">Index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">InfilesNamesCount</span><span class="p">):</span>
 1208         <span class="n">Infile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="n">Index</span><span class="p">]</span>
 1209         <span class="n">MeshLevel</span> <span class="o">=</span> <span class="n">MeshLevelWords</span><span class="p">[</span><span class="n">Index</span><span class="p">]</span>
 1210         <span class="k">if</span> <span class="ow">not</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">IsFloat</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">):</span>
 1211             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The mesh level, </span><span class="si">%s</span><span class="s2">, specified using </span><span class="se">\&quot;</span><span class="s2">--meshLevel</span><span class="se">\&quot;</span><span class="s2"> for input file, </span><span class="si">%s</span><span class="s2">, must be a float.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">MeshLevel</span><span class="p">,</span> <span class="n">Infile</span><span class="p">))</span>
 1212         
 1213         <span class="n">MeshLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">)</span>
 1214         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevels&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">MeshLevel</span><span class="p">)</span>
 1215     
 1216 <span class="k">def</span> <span class="nf">ProcessVolumeColorRamp</span><span class="p">():</span>
 1217     <span class="sd">&quot;&quot;&quot;Process volume color ramp.&quot;&quot;&quot;</span>
 1218     
 1219     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Processing volume color ramp...&quot;</span><span class="p">)</span>
 1220     
 1221     <span class="n">ColorRamp</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeColorRamp&quot;</span><span class="p">]</span>
 1222     <span class="n">ColorRampName</span> <span class="o">=</span> <span class="bp">None</span>
 1223     <span class="n">CreateColorRamp</span> <span class="o">=</span> <span class="bp">False</span>
 1224     <span class="n">ColorRampContourLevel</span> <span class="o">=</span> <span class="bp">None</span>
 1225     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^auto$&quot;</span><span class="p">,</span> <span class="n">ColorRamp</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1226         <span class="n">FirstInfile</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1227         <span class="n">RecommededContourLevel</span> <span class="o">=</span> <span class="n">RetrieveRecommededContourLevel</span><span class="p">(</span><span class="n">FirstInfile</span><span class="p">)</span>
 1228         <span class="k">if</span> <span class="n">RecommededContourLevel</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
 1229             <span class="n">ColorRampName</span> <span class="o">=</span> <span class="s2">&quot;default&quot;</span>
 1230             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintWarning</span><span class="p">(</span><span class="s2">&quot;Failed to retrieve recommended contour level from header file corresponding to input file, </span><span class="si">%s</span><span class="s2">, to create a new ramp. Using PyMOL default volume color ramp.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">FirstInfile</span><span class="p">))</span>
 1231         <span class="k">else</span><span class="p">:</span>
 1232             <span class="n">ColorRampName</span> <span class="o">=</span> <span class="s2">&quot;CryoEMAuto&quot;</span>
 1233             <span class="n">CreateColorRamp</span> <span class="o">=</span> <span class="bp">True</span>
 1234             <span class="n">ColorRampContourLevel</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">RecommededContourLevel</span><span class="p">)</span>
 1235             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Setting up a  new volume color ramp, </span><span class="si">%s</span><span class="s2">, at recommended contour level, </span><span class="si">%.2f</span><span class="s2">, from input file, </span><span class="si">%s</span><span class="s2">...&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">ColorRampName</span><span class="p">,</span> <span class="n">ColorRampContourLevel</span><span class="p">,</span> <span class="n">FirstInfile</span><span class="p">))</span>
 1236     <span class="k">else</span><span class="p">:</span>
 1237         <span class="n">ColorRampName</span> <span class="o">=</span> <span class="n">ColorRamp</span>
 1238         
 1239     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRamp&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorRamp</span>
 1240     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorRampName</span>
 1241     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampCreate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">CreateColorRamp</span>
 1242     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeColorRampContourLevel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ColorRampContourLevel</span>
 1243 
 1244 <span class="k">def</span> <span class="nf">ProcessOptions</span><span class="p">():</span>
 1245     <span class="sd">&quot;&quot;&quot;Process and validate command line arguments and options.&quot;&quot;&quot;</span>
 1246     
 1247     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="s2">&quot;Processing options...&quot;</span><span class="p">)</span>
 1248     
 1249     <span class="c1"># Validate options...</span>
 1250     <span class="n">ValidateOptions</span><span class="p">()</span>
 1251     
 1252     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Align&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--align&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1253     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMethod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMethod&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
 1254     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignMode&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMode&quot;</span><span class="p">]</span>
 1255     
 1256     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AllowEmptyObjects&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--allowEmptyObjects&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1257     
 1258     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorChainCartoonPutty&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--BFactorChainCartoonPutty&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1259     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;BFactorColorPalette&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--BFactorColorPalette&quot;</span><span class="p">]</span>
 1260     
 1261     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Infiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infiles&quot;</span><span class="p">]</span>
 1262     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infileNames&quot;</span><span class="p">]</span>
 1263     
 1264     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesEMDBIDs&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
 1265     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesRecommededContourLevels&quot;</span><span class="p">]</span> <span class="o">=</span>  <span class="p">{}</span>
 1266 
 1267     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;AlignRefFile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">]</span>
 1268     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1269         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;InfilesNames&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
 1270     <span class="k">else</span><span class="p">:</span>
 1271         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;RefFileName&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">]</span>
 1272     
 1273     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;DensityMapFiles&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--densityMapFiles&quot;</span><span class="p">]</span>
 1274     <span class="n">ProcessDensityMapFiles</span><span class="p">()</span>
 1275 
 1276     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">]</span>
 1277     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1278     
 1279     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">]</span>
 1280     <span class="n">FileDir</span><span class="p">,</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">FileExt</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ParseFileName</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span>
 1281     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">False</span> 
 1282     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^pml$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1283         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> 
 1284         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMEOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.pml$&quot;</span><span class="p">,</span> <span class="s2">&quot;.pme&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span> 
 1285     <span class="k">elif</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^pse$&quot;</span><span class="p">,</span> <span class="n">FileExt</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1286         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOut&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> 
 1287         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PSEOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">]</span> 
 1288         <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s2">&quot;.pse$&quot;</span><span class="p">,</span> <span class="s2">&quot;.pml&quot;</span><span class="p">,</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Outfile&quot;</span><span class="p">])</span> 
 1289         <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">])</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;Overwrite&quot;</span><span class="p">]):</span>
 1290             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;The intermediate output file to be generated, </span><span class="si">%s</span><span class="s2">, already exist. Use option </span><span class="se">\&quot;</span><span class="s2">--ov</span><span class="se">\&quot;</span><span class="s2"> or </span><span class="se">\&quot;</span><span class="s2">--overwrite</span><span class="se">\&quot;</span><span class="s2"> and try again.&quot;</span> <span class="o">%</span> <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PMLOutfile&quot;</span><span class="p">]</span> <span class="p">)</span>
 1291 
 1292     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LabelFontID&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--labelFontID&quot;</span><span class="p">])</span>
 1293     
 1294     <span class="c1"># Process mesh parameters...</span>
 1295     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshCarveRadius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshCarveRadius&quot;</span><span class="p">])</span>
 1296     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1297     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshChainComplex&quot;</span><span class="p">]</span>
 1298     
 1299     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshWidth&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshWidth&quot;</span><span class="p">])</span>
 1300     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshColor&quot;</span><span class="p">]</span>
 1301     
 1302     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;MeshLevel&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshLevel&quot;</span><span class="p">]</span>
 1303     <span class="n">ProcessMeshLevel</span><span class="p">()</span>
 1304     
 1305     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1306     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceChainComplex&quot;</span><span class="p">]</span>
 1307     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;SurfaceTransparency&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceTransparency&quot;</span><span class="p">])</span>
 1308     
 1309     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsLigandColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsLigandColor&quot;</span><span class="p">]</span>
 1310     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsSolventColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsSolventColor&quot;</span><span class="p">]</span>
 1311     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketContactsInorganicColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketContactsInorganicColor&quot;</span><span class="p">]</span>
 1312     
 1313     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketDistanceCutoff&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">])</span>
 1314     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketLabelColor&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketLabelColor&quot;</span><span class="p">]</span>
 1315     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;PocketSurface&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketSurface&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1316 
 1317     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeCarveRadius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeCarveRadius&quot;</span><span class="p">])</span>
 1318     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">True</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^Yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeComplex&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">)</span> <span class="k">else</span> <span class="bp">False</span>
 1319     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;VolumeChainComplex&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeChainComplex&quot;</span><span class="p">]</span>
 1320 
 1321     <span class="n">ProcessVolumeColorRamp</span><span class="p">()</span>
 1322 
 1323     <span class="n">RetrieveInfilesInfo</span><span class="p">()</span>
 1324     <span class="n">RetrieveRefFileInfo</span><span class="p">()</span>
 1325     
 1326     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;ChainIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--chainIDs&quot;</span><span class="p">]</span>
 1327     <span class="n">OptionsInfo</span><span class="p">[</span><span class="s2">&quot;LigandIDs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--ligandIDs&quot;</span><span class="p">]</span>
 1328     
 1329     <span class="n">ProcessChainAndLigandIDs</span><span class="p">()</span>
 1330 
 1331 <span class="k">def</span> <span class="nf">RetrieveOptions</span><span class="p">():</span> 
 1332     <span class="sd">&quot;&quot;&quot;Retrieve command line arguments and options&quot;&quot;&quot;</span>
 1333     
 1334     <span class="c1"># Get options...</span>
 1335     <span class="k">global</span> <span class="n">Options</span>
 1336     <span class="n">Options</span> <span class="o">=</span> <span class="n">docopt</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">)</span>
 1337     
 1338     <span class="c1"># Set current working directory to the specified directory...</span>
 1339     <span class="n">WorkingDir</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--workingdir&quot;</span><span class="p">]</span>
 1340     <span class="k">if</span> <span class="n">WorkingDir</span><span class="p">:</span>
 1341         <span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="n">WorkingDir</span><span class="p">)</span>
 1342     
 1343     <span class="c1"># Handle examples option...</span>
 1344     <span class="k">if</span> <span class="s2">&quot;--examples&quot;</span> <span class="ow">in</span> <span class="n">Options</span> <span class="ow">and</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--examples&quot;</span><span class="p">]:</span>
 1345         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintInfo</span><span class="p">(</span><span class="n">MiscUtil</span><span class="o">.</span><span class="n">GetExamplesTextFromDocOptText</span><span class="p">(</span><span class="n">_docoptUsage_</span><span class="p">))</span>
 1346         <span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
 1347 
 1348 <span class="k">def</span> <span class="nf">ValidateOptions</span><span class="p">():</span>
 1349     <span class="sd">&quot;&quot;&quot;Validate option values&quot;&quot;&quot;</span>
 1350     
 1351     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--align&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--align&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1352     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--alignMethod&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMethod&quot;</span><span class="p">],</span> <span class="s2">&quot;align cealign super&quot;</span><span class="p">)</span>
 1353     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--alignMode&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignMode&quot;</span><span class="p">],</span> <span class="s2">&quot;FirstChain Complex&quot;</span><span class="p">)</span>
 1354     
 1355     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--allowEmptyObjects&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--allowEmptyObjects&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1356     
 1357     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--BFactorChainCartoonPutty&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--BFactorChainCartoonPutty&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1358 
 1359     <span class="c1"># Expand infiles to handle presence of multiple input files...</span>
 1360     <span class="n">InfileNames</span> <span class="o">=</span> <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ExpandFileNames</span><span class="p">(</span><span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infiles&quot;</span><span class="p">],</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
 1361     <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">InfileNames</span><span class="p">):</span>
 1362         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">PrintError</span><span class="p">(</span><span class="s2">&quot;No input files specified for </span><span class="se">\&quot;</span><span class="s2">-i, --infiles</span><span class="se">\&quot;</span><span class="s2"> option&quot;</span><span class="p">)</span>
 1363 
 1364     <span class="c1"># Validate file extensions...</span>
 1365     <span class="k">for</span> <span class="n">Infile</span> <span class="ow">in</span> <span class="n">InfileNames</span><span class="p">:</span>
 1366         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;-i, --infiles&quot;</span><span class="p">,</span> <span class="n">Infile</span><span class="p">)</span>
 1367         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-i, --infiles&quot;</span><span class="p">,</span> <span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;pdb cif&quot;</span><span class="p">)</span>
 1368         <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsDistinctFileNames</span><span class="p">(</span><span class="s2">&quot;-i, --infiles&quot;</span><span class="p">,</span> <span class="n">Infile</span><span class="p">,</span> <span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1369     <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--infileNames&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">InfileNames</span>
 1370     
 1371     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;pml pse&quot;</span><span class="p">)</span>
 1372     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsOutputFileOverwrite</span><span class="p">(</span><span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">],</span> <span class="s2">&quot;--overwrite&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--overwrite&quot;</span><span class="p">])</span>
 1373     
 1374     <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^yes$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--align&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1375         <span class="k">if</span> <span class="ow">not</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s2">&quot;^FirstInputFile$&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">],</span> <span class="n">re</span><span class="o">.</span><span class="n">I</span><span class="p">):</span>
 1376             <span class="n">AlignRefFile</span> <span class="o">=</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">]</span>
 1377             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFilePath</span><span class="p">(</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">,</span> <span class="n">AlignRefFile</span><span class="p">)</span>
 1378             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFileExt</span><span class="p">(</span><span class="s2">&quot;--alignRefFile&quot;</span><span class="p">,</span> <span class="n">AlignRefFile</span><span class="p">,</span> <span class="s2">&quot;pdb cif&quot;</span><span class="p">)</span>
 1379             <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionsDistinctFileNames</span><span class="p">(</span><span class="s2">&quot;--AlignRefFile&quot;</span><span class="p">,</span> <span class="n">AlignRefFile</span><span class="p">,</span> <span class="s2">&quot;-o, --outfile&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--outfile&quot;</span><span class="p">])</span>
 1380     
 1381     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1382     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionIntegerValue</span><span class="p">(</span><span class="s2">&quot;--labelFontID&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--labelFontID&quot;</span><span class="p">],</span> <span class="p">{})</span>
 1383 
 1384     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--meshCarveRadius&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshCarveRadius&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1385     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--meshComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1386     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--meshChainComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshChainComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1387     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--meshWidth&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--meshWidth&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1388     
 1389     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--PMLOut&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1390     
 1391     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketDistanceCutoff&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1392     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--pocketSurface&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--pocketSurface&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1393     
 1394     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--surfaceComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1395     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--surfaceChainComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceChainComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1396     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--surfaceTransparency&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--surfaceTransparency&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;=&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span> <span class="s2">&quot;&lt;=&quot;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">})</span>
 1397     
 1398     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionFloatValue</span><span class="p">(</span><span class="s2">&quot;--volumeCarveRadius&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeCarveRadius&quot;</span><span class="p">],</span> <span class="p">{</span><span class="s2">&quot;&gt;&quot;</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">})</span>
 1399     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--volumeComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no&quot;</span><span class="p">)</span>
 1400     <span class="n">MiscUtil</span><span class="o">.</span><span class="n">ValidateOptionTextValue</span><span class="p">(</span><span class="s2">&quot;--volumeChainComplex&quot;</span><span class="p">,</span> <span class="n">Options</span><span class="p">[</span><span class="s2">&quot;--volumeChainComplex&quot;</span><span class="p">],</span> <span class="s2">&quot;yes no auto&quot;</span><span class="p">)</span>
 1401     
 1402 <span class="c1"># Setup a usage string for docopt...</span>
 1403 <span class="n">_docoptUsage_</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
 1404 <span class="s2">PyMOLVisualizeCryoEMDensity.py - Visualize cryo-EM density</span>
 1405 
 1406 <span class="s2">Usage:</span>
 1407 <span class="s2">    PyMOLVisualizeCryoEMDensity.py  [--align &lt;yes or no&gt;] [--alignMethod &lt;align, cealign, super&gt;]</span>
 1408 <span class="s2">                                   [--alignMode &lt;FirstChain or Complex&gt;] [--alignRefFile &lt;filename&gt;]</span>
 1409 <span class="s2">                                   [--allowEmptyObjects &lt;yes or no&gt;] [--BFactorChainCartoonPutty &lt;yes or no&gt;]</span>
 1410 <span class="s2">                                   [--BFactorColorPalette &lt;text&gt; ] [--chainIDs &lt;First, All or ID1,ID2...&gt;]</span>
 1411 <span class="s2">                                   [--densityMapFiles &lt;file1,file2,file3,...&gt;]</span>
 1412 <span class="s2">                                   [--ligandIDs &lt;Largest, All or ID1,ID2...&gt;] [--labelFontID &lt;number&gt;]</span>
 1413 <span class="s2">                                   [--meshCarveRadius &lt;number&gt;] [--meshComplex &lt;yes or no&gt;]</span>
 1414 <span class="s2">                                   [--meshChainComplex &lt;yes, no, or auto&gt;] [--meshColor &lt;text&gt;]</span>
 1415 <span class="s2">                                   [--meshLevel &lt;number&gt;] [--meshWidth &lt;number&gt;] [--PMLOut &lt;yes or no&gt;]</span>
 1416 <span class="s2">                                   [--pocketContactsLigandColor &lt;text&gt;] [--pocketContactsSolventColor &lt;text&gt;]</span>
 1417 <span class="s2">                                   [--pocketContactsInorganicColor &lt;text&gt;] [--pocketDistanceCutoff &lt;number&gt;]</span>
 1418 <span class="s2">                                   [--pocketLabelColor &lt;text&gt;] [--pocketSurface &lt;yes or no&gt;]</span>
 1419 <span class="s2">                                   [--surfaceComplex &lt;yes or no&gt;] [--surfaceChainComplex &lt;yes, no or auto&gt;]</span>
 1420 <span class="s2">                                   [--surfaceTransparency &lt;number&gt;] [--volumeCarveRadius &lt;number&gt;]</span>
 1421 <span class="s2">                                   [--volumeComplex &lt;yes or no&gt;] [--volumeChainComplex &lt;yes, no, or auto&gt;]</span>
 1422 <span class="s2">                                   [--volumeColorRamp &lt;text&gt;]   [--overwrite] [-w &lt;dir&gt;] -i &lt;infile1,infile2,...&gt; -o &lt;outfile&gt;</span>
 1423 <span class="s2">    PyMOLVisualizeCryoEMDensity.py -h | --help | -e | --examples</span>
 1424 
 1425 <span class="s2">Description:</span>
 1426 <span class="s2">    Generate PyMOL visualization files for viewing electron microscopy (EM) or</span>
 1427 <span class="s2">    cryo-EM density around chains, ligands, and ligand binding pockets in</span>
 1428 <span class="s2">    macromolecules including proteins and nucleic acids.</span>
 1429 
 1430 <span class="s2">    The supported input file formats are: Macromolecule - PDB (.pdb) or CIF(.cif),</span>
 1431 <span class="s2">    Cryo-EM Density - Collaborative Computational Project Number 4 (CCP4) ( .map)</span>
 1432 
 1433 <span class="s2">    The supported output file formats are: PyMOL script file (.pml), PyMOL session</span>
 1434 <span class="s2">    file (.pse)</span>
 1435 
 1436 <span class="s2">    The cryo-EM density and header files along with PDB files may be downloaded</span>
 1437 <span class="s2">    from appropriate servers using DownloadPDBFiles.pl script.</span>
 1438 
 1439 <span class="s2">    A variety of PyMOL groups and objects may be  created for visualization of</span>
 1440 <span class="s2">    cryo-EM density present in map files. These groups and objects correspond to</span>
 1441 <span class="s2">    maps, volumes, meshes, surfaces,chains, ligands, inorganics, ligand binding</span>
 1442 <span class="s2">    pockets, polar interactions, and pocket hydrophobic surfaces. A complete</span>
 1443 <span class="s2">    hierarchy of all possible PyMOL groups and objects is shown below:</span>
 1444 <span class="s2">    </span>
 1445 <span class="s2">        &lt;PDBFileRoot&gt;</span>
 1446 <span class="s2">            .Complex</span>
 1447 <span class="s2">                .Complex</span>
 1448 <span class="s2">                .CryoEM</span>
 1449 <span class="s2">                    .Map</span>
 1450 <span class="s2">                    .Volume</span>
 1451 <span class="s2">                    .Mesh</span>
 1452 <span class="s2">                    .Surface</span>
 1453 <span class="s2">            .Chain&lt;ID&gt;</span>
 1454 <span class="s2">                .Complex</span>
 1455 <span class="s2">                    .Complex</span>
 1456 <span class="s2">                    .CryoEM</span>
 1457 <span class="s2">                        .Volume</span>
 1458 <span class="s2">                        .Mesh</span>
 1459 <span class="s2">                        .Surface</span>
 1460 <span class="s2">                .Chain</span>
 1461 <span class="s2">                    .Chain</span>
 1462 <span class="s2">                    .BFactor</span>
 1463 <span class="s2">                .Solvent</span>
 1464 <span class="s2">                .Inorganic</span>
 1465 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1466 <span class="s2">                    .Ligand</span>
 1467 <span class="s2">                        .Ligand</span>
 1468 <span class="s2">                        .CryoEM</span>
 1469 <span class="s2">                            .Volume</span>
 1470 <span class="s2">                            .Mesh</span>
 1471 <span class="s2">                            .Surface</span>
 1472 <span class="s2">                    .Pocket</span>
 1473 <span class="s2">                        .Pocket</span>
 1474 <span class="s2">                        .CryoEM</span>
 1475 <span class="s2">                            .Volume</span>
 1476 <span class="s2">                            .Mesh</span>
 1477 <span class="s2">                            .Surface</span>
 1478 <span class="s2">                        .Polar_Contacts</span>
 1479 <span class="s2">                        .Surface</span>
 1480 <span class="s2">                    .Pocket_Solvent</span>
 1481 <span class="s2">                        .Pocket_Solvent</span>
 1482 <span class="s2">                        .CryoEM</span>
 1483 <span class="s2">                            .Volume</span>
 1484 <span class="s2">                            .Mesh</span>
 1485 <span class="s2">                            .Surface</span>
 1486 <span class="s2">                        .Polar_Contacts</span>
 1487 <span class="s2">                    .Pocket_Inorganic</span>
 1488 <span class="s2">                        .Pocket_Inorganic</span>
 1489 <span class="s2">                        .CryoEM</span>
 1490 <span class="s2">                            .Volume</span>
 1491 <span class="s2">                            .Mesh</span>
 1492 <span class="s2">                            .Surface</span>
 1493 <span class="s2">                        .Polar_Contacts</span>
 1494 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1495 <span class="s2">                    .Ligand</span>
 1496 <span class="s2">                        ... ... ...</span>
 1497 <span class="s2">                    .Pocket</span>
 1498 <span class="s2">                        ... ... ...</span>
 1499 <span class="s2">                    .Pocket_Solvent</span>
 1500 <span class="s2">                        ... ... ...</span>
 1501 <span class="s2">                    .Pocket_Inorganic</span>
 1502 <span class="s2">                        ... ... ...</span>
 1503 <span class="s2">            .Chain&lt;ID&gt;</span>
 1504 <span class="s2">                ... ... ...</span>
 1505 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1506 <span class="s2">                    ... ... ...</span>
 1507 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1508 <span class="s2">                    ... ... ...</span>
 1509 <span class="s2">            .Chain&lt;ID&gt;</span>
 1510 <span class="s2">                ... ... ...</span>
 1511 <span class="s2">        &lt;PDBFileRoot&gt;</span>
 1512 <span class="s2">            .Complex</span>
 1513 <span class="s2">                ... ... ...</span>
 1514 <span class="s2">            .Chain&lt;ID&gt;</span>
 1515 <span class="s2">                ... ... ...</span>
 1516 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1517 <span class="s2">                    ... ... ...</span>
 1518 <span class="s2">                .Ligand&lt;ID&gt;</span>
 1519 <span class="s2">                    ... ... ...</span>
 1520 <span class="s2">            .Chain&lt;ID&gt;</span>
 1521 <span class="s2">                ... ... ...</span>
 1522 <span class="s2">    </span>
 1523 <span class="s2">    The meshes, volumes, and surfaces  are not created for complete complex in input</span>
 1524 <span class="s2">    files by default. A word to the wise: The creation of these mesh, volume, and surface</span>
 1525 <span class="s2">    objects may slow down loading of PML file and generation of PSE file, based on the</span>
 1526 <span class="s2">    size of input complex and map files. The generation of PSE file may also fail. In </span>
 1527 <span class="s2">    addition, you may want to interactively manipulate the contour level for meshes,</span>
 1528 <span class="s2">    volumes, and surfaces. The recommended value for contour level is automatically</span>
 1529 <span class="s2">    retrieved from header files available from EM density server. The recommended</span>
 1530 <span class="s2">    value may not always work.</span>
 1531 
 1532 <span class="s2">Options:</span>
 1533 <span class="s2">    -a, --align &lt;yes or no&gt;  [default: no]</span>
 1534 <span class="s2">        Align input files to a reference file before visualization along with</span>
 1535 <span class="s2">        available cryo-EM density map files.</span>
 1536 <span class="s2">    --alignMethod &lt;align, cealign, super&gt;  [default: super]</span>
 1537 <span class="s2">        Alignment methodology to use for aligning input files to a reference</span>
 1538 <span class="s2">        file.</span>
 1539 <span class="s2">    --alignMode &lt;FirstChain or Complex&gt;  [default: FirstChain]</span>
 1540 <span class="s2">        Portion of input and reference files to use for spatial alignment of</span>
 1541 <span class="s2">        input files against reference file.  Possible values: FirstChain or</span>
 1542 <span class="s2">        Complex.</span>
 1543 <span class="s2">        </span>
 1544 <span class="s2">        The FirstChain mode allows alignment of the first chain in each input</span>
 1545 <span class="s2">        file to the first chain in the reference file along with moving the rest</span>
 1546 <span class="s2">        of the complex to coordinate space of the reference file. The complete</span>
 1547 <span class="s2">        complex in each input file is aligned to the complete complex in reference</span>
 1548 <span class="s2">        file for the Complex mode.</span>
 1549 <span class="s2">    --alignRefFile &lt;filename&gt;  [default: FirstInputFile]</span>
 1550 <span class="s2">        Reference input file name. The default is to use the first input file</span>
 1551 <span class="s2">        name specified using &#39;-i, --infiles&#39; option.</span>
 1552 <span class="s2">    --allowEmptyObjects &lt;yes or no&gt;  [default: no]</span>
 1553 <span class="s2">        Allow creation of empty PyMOL objects corresponding to solvent and</span>
 1554 <span class="s2">        inorganic atom selections across chains, ligands, and ligand binding pockets</span>
 1555 <span class="s2">        in input file(s).</span>
 1556 <span class="s2">    -b, --BFactorChainCartoonPutty &lt;yes or no&gt;  [default: yes]</span>
 1557 <span class="s2">        A cartoon putty around individual chains colored by B factors. The minimum</span>
 1558 <span class="s2">        and maximum values for B factors are automatically detected. These values</span>
 1559 <span class="s2">        indicate spread of cryo-EM density around atoms. The &#39;blue_white_red&#39; color</span>
 1560 <span class="s2">        palette is deployed for coloring the cartoon putty.</span>
 1561 <span class="s2">    --BFactorColorPalette &lt;text&gt;  [default: blue_white_red]</span>
 1562 <span class="s2">        Color palette for coloring cartoon putty around chains generated using B</span>
 1563 <span class="s2">        factors. Any valid PyMOL color palette name is allowed. No validation is</span>
 1564 <span class="s2">        performed. The complete list of valid color palette names is a available</span>
 1565 <span class="s2">        at: pymolwiki.org/index.php/Spectrum. Examples: blue_white_red,</span>
 1566 <span class="s2">        blue_white_magenta, blue_red, green_white_red, green_red.</span>
 1567 <span class="s2">    -c, --chainIDs &lt;First, All or ID1,ID2...&gt;  [default: First]</span>
 1568 <span class="s2">        List of chain IDs to use for visualizing cryo-EM density. Possible values:</span>
 1569 <span class="s2">        First, All, or a comma delimited list of chain IDs. The default is to use the</span>
 1570 <span class="s2">        chain ID for the first chain in each input file.</span>
 1571 <span class="s2">    -d, --densityMapFiles &lt;file1,file2,file3,...&gt;  [default: auto]</span>
 1572 <span class="s2">        CryoEM density map file names. The EMDB ID is retrieved from PDB and CIF</span>
 1573 <span class="s2">        file to set the cryo-EM density file name during automatic detection of</span>
 1574 <span class="s2">        density files. The format of the file name is as follows:</span>
 1575 <span class="s2">        </span>
 1576 <span class="s2">            emd_&lt;EMDBID&gt;.map.gz or emd_&lt;EMDBID&gt;.map</span>
 1577 <span class="s2">         </span>
 1578 <span class="s2">        The density files must be present in the working directory.</span>
 1579 <span class="s2">    -e, --examples</span>
 1580 <span class="s2">        Print examples.</span>
 1581 <span class="s2">    -h, --help</span>
 1582 <span class="s2">        Print this help message.</span>
 1583 <span class="s2">    -i, --infiles &lt;infile1,infile2,infile3...&gt;</span>
 1584 <span class="s2">        Input file names.</span>
 1585 <span class="s2">    -l, --ligandIDs &lt;Largest, All or ID1,ID2...&gt;  [default: Largest]</span>
 1586 <span class="s2">        List of ligand IDs present in chains for visualizing cryo-EM density across</span>
 1587 <span class="s2">        ligands and ligand binding pockets. Possible values: Largest, All, or a comma</span>
 1588 <span class="s2">        delimited list of ligand IDs. The default is to use the largest ligand present</span>
 1589 <span class="s2">        in all or specified chains in each input file.</span>
 1590 <span class="s2">        </span>
 1591 <span class="s2">        Ligands are identified using organic selection operator available in PyMOL.</span>
 1592 <span class="s2">        It&#39;ll also  identify buffer molecules as ligands. The largest ligand contains</span>
 1593 <span class="s2">        the highest number of heavy atoms.</span>
 1594 <span class="s2">    --labelFontID &lt;number&gt;  [default: 7]</span>
 1595 <span class="s2">        Font ID for drawing labels. Default: 7 (Sans Bold). Valid values: 5 to 16.</span>
 1596 <span class="s2">        The specified value must be a valid PyMOL font ID. No validation is</span>
 1597 <span class="s2">        performed. The complete lists of valid font IDs is available at:</span>
 1598 <span class="s2">        pymolwiki.org/index.php/Label_font_id. Examples: 5 - Sans;</span>
 1599 <span class="s2">        7 - Sans Bold; 9 - Serif; 10 - Serif Bold.</span>
 1600 <span class="s2">    --meshCarveRadius &lt;number&gt;  [default: 1.6]</span>
 1601 <span class="s2">        Radius in Angstroms around atoms for including cryo-EM density.</span>
 1602 <span class="s2">    --meshComplex &lt;yes or no&gt;  [default: no]</span>
 1603 <span class="s2">        Create meshes for complete complex in each input file using corresponding</span>
 1604 <span class="s2">        density map file.</span>
 1605 <span class="s2">    --meshChainComplex &lt;yes, no, or auto&gt;  [default: auto]</span>
 1606 <span class="s2">        Create meshes for individual chain complex in each input file using</span>
 1607 <span class="s2">        corresponding density map file. By default, the meshes are automatically</span>
 1608 <span class="s2">        created for chain complexes without any ligands. </span>
 1609 <span class="s2">    --meshColor &lt;text&gt;  [default: blue]</span>
 1610 <span class="s2">        Line color for meshes corresponding to density maps.. The specified value</span>
 1611 <span class="s2">        must be valid color. No validation is performed.</span>
 1612 <span class="s2">    --meshLevel &lt;number1,number2,...&gt;  [default: auto]</span>
 1613 <span class="s2">        Comma delimited list of contour levels in sigma units for generating meshes</span>
 1614 <span class="s2">        for each input file using corresponding density map file. The default is to</span>
 1615 <span class="s2">        automatically retrieve the recommended contour levels for each input </span>
 1616 <span class="s2">        file. The header file emd-&lt;EMDBID&gt;.xml corresponding to an input file</span>
 1617 <span class="s2">        must be present in the working directory  to automatically retrieve</span>
 1618 <span class="s2">        recommended value for mesh contour level. Otherwise, the default contour</span>
 1619 <span class="s2">        level is set to 1.</span>
 1620 <span class="s2">        </span>
 1621 <span class="s2">        You may want to interactively manipulate the contour level for meshes and</span>
 1622 <span class="s2">        surfaces. The default recommended value may not always work.</span>
 1623 <span class="s2">    --meshWidth &lt;number&gt;  [default: 0.5]</span>
 1624 <span class="s2">        Line width for mesh lines corresponding to density maps.</span>
 1625 <span class="s2">    -o, --outfile &lt;outfile&gt;</span>
 1626 <span class="s2">        Output file name.</span>
 1627 <span class="s2">    -p, --PMLOut &lt;yes or no&gt;  [default: yes]</span>
 1628 <span class="s2">        Save PML file during generation of PSE file.</span>
 1629 <span class="s2">    --pocketContactsLigandColor &lt;text&gt;  [default: orange]</span>
 1630 <span class="s2">        Color for drawing polar contacts between ligand and pocket residues.</span>
 1631 <span class="s2">        The specified value must be valid color. No validation is performed.</span>
 1632 <span class="s2">    --pocketContactsSolventColor &lt;text&gt;  [default: marine]</span>
 1633 <span class="s2">        Color for drawing polar contacts between solvent and pocket residues.</span>
 1634 <span class="s2">        The specified value must be valid color. No validation is performed.</span>
 1635 <span class="s2">    --pocketContactsInorganicColor &lt;text&gt;  [default: deepsalmon]</span>
 1636 <span class="s2">        Color for drawing polar contacts between inorganic and pocket residues.</span>
 1637 <span class="s2">        The specified value must be valid color. No validation is performed.</span>
 1638 <span class="s2">    --pocketDistanceCutoff &lt;number&gt;  [default: 5.0]</span>
 1639 <span class="s2">        Distance in Angstroms for identifying pocket residues around ligands.</span>
 1640 <span class="s2">    --pocketLabelColor &lt;text&gt;  [default: magenta]</span>
 1641 <span class="s2">        Color for drawing residue or atom level labels for a pocket. The specified</span>
 1642 <span class="s2">        value must be valid color. No validation is performed.</span>
 1643 <span class="s2">    --pocketSurface &lt;yes or no&gt;  [default: yes]</span>
 1644 <span class="s2">        Hydrophobic surface around pocket. The pocket surface is colored by</span>
 1645 <span class="s2">        hydrophobicity. It is only valid for proteins. The color of amino acids is</span>
 1646 <span class="s2">        set using the Eisenberg hydrophobicity scale. The color varies from red</span>
 1647 <span class="s2">        to white, red being the most hydrophobic amino acid.</span>
 1648 <span class="s2">    --surfaceComplex &lt;yes or no&gt;  [default: no]</span>
 1649 <span class="s2">        Create surfaces for complete complex in input file(s) corresponding to density</span>
 1650 <span class="s2">        map.</span>
 1651 <span class="s2">    --surfaceChainComplex &lt;yes, no or auto&gt;  [default: auto]</span>
 1652 <span class="s2">        Create surfaces for individual chain complexes in each input file using corresponding</span>
 1653 <span class="s2">        density map file. By default, the surfaces are automatically created for chain complexes</span>
 1654 <span class="s2">        without any ligands.</span>
 1655 <span class="s2">    --surfaceTransparency &lt;number&gt;  [default: 0.25]</span>
 1656 <span class="s2">        Surface transparency for molecular and cryo-EM density surfaces.</span>
 1657 <span class="s2">    --overwrite</span>
 1658 <span class="s2">        Overwrite existing files.</span>
 1659 <span class="s2">    --volumeCarveRadius &lt;number&gt;  [default: 1.6]</span>
 1660 <span class="s2">        Radius in Angstroms around atoms for including cryo-EM density.</span>
 1661 <span class="s2">    --volumeComplex &lt;yes or no&gt;  [default: no]</span>
 1662 <span class="s2">        Create volumes for complete complex in each input file using corresponding density</span>
 1663 <span class="s2">        map file.</span>
 1664 <span class="s2">    --volumeChainComplex &lt;yes, no, or auto&gt;  [default: auto]</span>
 1665 <span class="s2">        Create volumes for individual chain complex in each input file using corresponding</span>
 1666 <span class="s2">        density map file. By default, the volumes are automatically created for chain</span>
 1667 <span class="s2">        complexes without any ligands.</span>
 1668 <span class="s2">    --volumeColorRamp &lt;text&gt;  [default: auto]</span>
 1669 <span class="s2">        Name of a volume color ramp for density map files. The specified value must</span>
 1670 <span class="s2">        be a valid name. No validation is performed. The following volume color ramps</span>
 1671 <span class="s2">        are currently available in PyMOL: default, 2fofc, fofc, rainbow, and rainbow2.</span>
 1672 <span class="s2">        </span>
 1673 <span class="s2">        The default is to automatically create a new volume color ramp for the first</span>
 1674 <span class="s2">        input file using recommended contour level with an offset of 0.3 around this value.</span>
 1675 <span class="s2">        The header file emd-&lt;EMDBID&gt;.xml must be present in the working directory  to</span>
 1676 <span class="s2">        automatically retrieve recommended contour level and generate a  volume color ramp.</span>
 1677 <span class="s2">        Otherwise, PyMOL default volume color ramp is employed to color volumes.</span>
 1678 <span class="s2">        </span>
 1679 <span class="s2">        The volume color ramp automatically created for the first input file is used for all</span>
 1680 <span class="s2">        other input files.</span>
 1681 <span class="s2">    -w, --workingdir &lt;dir&gt;</span>
 1682 <span class="s2">        Location of working directory which defaults to the current directory.</span>
 1683 
 1684 <span class="s2">Examples:</span>
 1685 <span class="s2">    To download structure and cryo-EM data for 5K12, 5UMD, 5W81, and 5UAK</span>
 1686 <span class="s2">    before running the following examples, type:</span>
 1687 
 1688 <span class="s2">        % DownloadPDBFiles.pl --DensityMap yes 5K12,5UMD,5W81,5UAK</span>
 1689 
 1690 <span class="s2">    To visualize cryo-EM density at recommended contour level for the first</span>
 1691 <span class="s2">    chain complex in a PDB file using corresponding density map and header</span>
 1692 <span class="s2">    file, and generate a PML file type:</span>
 1693 
 1694 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -i 5K12.pdb -o 5K12.pml</span>
 1695 
 1696 <span class="s2">    To visualize electron density for the largest ligand in  chain K, and ligand</span>
 1697 <span class="s2">    binding pocket to highlight ligand interactions with pockect residues,</span>
 1698 <span class="s2">    solvents and inorganics, in a PDB and using corresponding map files, and</span>
 1699 <span class="s2">    generate a PML file, type:</span>
 1700 
 1701 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -c K -i 5UMD.cif -o 5UMD.pml</span>
 1702 
 1703 <span class="s2">    To visualize cryo-EM density for all  chains along with any solvents in a</span>
 1704 <span class="s2">    PDB file and using corresponding map files, and generate a PML file, type:</span>
 1705 
 1706 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -c all -i 5K12.pdb -o 5K12.pml</span>
 1707 
 1708 <span class="s2">    To visualize cryo-EM density at a specific contour level for the first chain</span>
 1709 <span class="s2">    complex along with volume and surface in a PDB file using corresponding</span>
 1710 <span class="s2">    to a specific density map file, and generate a PML file, type:</span>
 1711 
 1712 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -d emd_8194.map.gz --meshLevel 1.0</span>
 1713 <span class="s2">          --surfaceChainComplex yes --volumeChainComplex yes -i 5K12.pdb</span>
 1714 <span class="s2">          -o 5K12.pml</span>
 1715 
 1716 <span class="s2">    To align and visualize cryo-EM density at recommended contour levels for the</span>
 1717 <span class="s2">    largest ligand in the first chain along with pockets or the first chain complex</span>
 1718 <span class="s2">    in input files using corresponding maps and header files, type:</span>
 1719 
 1720 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -a yes -i &quot;5W81.pdb,5UAK.pdb&quot;</span>
 1721 <span class="s2">          -o SampleOut.pml</span>
 1722 
 1723 <span class="s2">    To align and visualize cryo-EM density at recommended contour levels for all</span>
 1724 <span class="s2">    chains and ligands in input files using specified density files, type:</span>
 1725 <span class="s2">    in input files using corresponding maps and header files, type:</span>
 1726 
 1727 <span class="s2">        % PyMOLVisualizeCryoEMDensity.py -a yes -i &quot;5W81.pdb,5UAK.pdb&quot;</span>
 1728 <span class="s2">          -o SampleOut.pml -c all -l all -d &quot;emd_8782.map.gz,emd_8516.map.gz&quot;</span>
 1729 
 1730 <span class="s2">Author:</span>
 1731 <span class="s2">    Manish Sud(msud@san.rr.com)</span>
 1732 
 1733 <span class="s2">See also:</span>
 1734 <span class="s2">    DownloadPDBFiles.pl,  PyMOLVisualizeElectronDensity.py,</span>
 1735 <span class="s2">    PyMOLVisualizeMacromolecules.py</span>
 1736 
 1737 <span class="s2">Copyright:</span>
 1738 <span class="s2">    Copyright (C) 2018 Manish Sud. All rights reserved.</span>
 1739 
 1740 <span class="s2">    The functionality available in this script is implemented using PyMOL, a</span>
 1741 <span class="s2">    molecular visualization system on an open source foundation originally</span>
 1742 <span class="s2">    developed by Warren DeLano.</span>
 1743 
 1744 <span class="s2">    This file is part of MayaChemTools.</span>
 1745 
 1746 <span class="s2">    MayaChemTools is free software; you can redistribute it and/or modify it under</span>
 1747 <span class="s2">    the terms of the GNU Lesser General Public License as published by the Free</span>
 1748 <span class="s2">    Software Foundation; either version 3 of the License, or (at your option) any</span>
 1749 <span class="s2">    later version.</span>
 1750 
 1751 <span class="s2">&quot;&quot;&quot;</span>
 1752 
 1753 <span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
 1754     <span class="n">main</span><span class="p">()</span>
</pre>
<br />
<center>
<img src="../../../images/h2o2.png">
</center>
</body>
</html>
